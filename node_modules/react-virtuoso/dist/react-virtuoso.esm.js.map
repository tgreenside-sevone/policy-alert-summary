{"version":3,"file":"react-virtuoso.esm.js","sources":["../src/VirtuosoContext.tsx","../src/tinyrx.ts","../src/EngineCommons.ts","../src/engines/adjustForPrependedItemsEngine.ts","../src/engines/followOutputEngine.ts","../src/AATree.ts","../src/GroupIndexTransposer.ts","../src/engines/groupCountEgine.ts","../src/engines/listEngine.ts","../src/engines/maxRangeSizeEngine.ts","../src/OffsetList.ts","../src/engines/initialItemCountEngine.ts","../src/engines/stickyItemsEngine.ts","../src/engines/offsetListEngine.ts","../src/engines/scrolledToBottomEngine.ts","../src/engines/scrollSeekEngine.ts","../src/engines/initialTopMostItemEngine.ts","../src/engines/scrollToIndexEngine.ts","../src/engines/topItemCountEngine.ts","../src/engines/topListEngine.ts","../src/rxio.ts","../src/VirtuosoStore.tsx","../src/Style.tsx","../src/Utils.tsx","../src/VirtuosoFiller.tsx","../src/VirtuosoList.tsx","../src/VirtuosoScroller.tsx","../src/VirtuosoView.tsx","../src/Virtuoso.tsx","../src/GroupedVirtuoso.tsx","../src/VirtuosoGridEngine.ts","../src/VirtuosoGrid.tsx"],"sourcesContent":["import { createContext } from 'react'\nimport { VirtuosoStore } from './VirtuosoStore'\n\nexport const VirtuosoContext = createContext<ReturnType<typeof VirtuosoStore> | undefined>(undefined)\n","export type TSubscriber<T> = (val: T) => void\nexport type TSubscription = () => void\nexport type TSubscribe<T> = (subscriber: TSubscriber<T>) => TSubscription\nexport type TOperator<T, K> = (val: T, done: (result: K) => void) => void\n\nexport interface TObservable<T> {\n  subscribe: TSubscribe<T>\n  pipe(...operators: []): TObservable<T>\n  pipe<R1>(...operators: [TOperator<T, R1>]): TObservable<R1>\n  pipe<R1, R2>(...operators: [TOperator<T, R1>, TOperator<R1, R2>]): TObservable<R2>\n  pipe<R1, R2, R3>(...operators: [TOperator<T, R1>, TOperator<R1, R2>, TOperator<R2, R3>]): TObservable<R3>\n  pipe<R1, R2, R3, R4>(\n    ...operators: [TOperator<T, R1>, TOperator<R1, R2>, TOperator<R2, R3>, TOperator<R3, R4>]\n  ): TObservable<R4>\n}\n\nexport interface TSubject<T> extends TObservable<T> {\n  next(val: T): void\n  subscribers: TSubscriber<T>[]\n}\n\nfunction combineOperators<A1>(): TOperator<A1, A1>\nfunction combineOperators<A1, R1>(o1: TOperator<A1, R1>): TOperator<A1, R1>\nfunction combineOperators<A1, R1, R2>(o1: TOperator<A1, R1>, o2: TOperator<R1, R2>): TOperator<A1, R2>\nfunction combineOperators<A1, R1, R2>(o1: TOperator<A1, R1>, o2: TOperator<R1, R2>): TOperator<A1, R2>\nfunction combineOperators<A1, R1, R2, R3>(\n  o1: TOperator<A1, R1>,\n  o2: TOperator<R1, R2>,\n  o3: TOperator<R2, R3>\n): TOperator<A1, R3>\nfunction combineOperators<A1, R1, R2, R3, R4>(\n  o1: TOperator<A1, R1>,\n  o2: TOperator<R1, R2>,\n  o3: TOperator<R2, R3>,\n  o4: TOperator<R3, R4>\n): TOperator<A1, R4>\nfunction combineOperators<T>(...operators: TOperator<any, any>[]): TOperator<T, any>\nfunction combineOperators<T, K>(...operators: TOperator<any, any>[]) {\n  if (operators.length === 0) {\n    return (value: T, subscriber: (value: T) => void) => subscriber(value)\n  }\n  if (operators.length === 1) {\n    return operators[0]\n  }\n\n  return (value: T, subscriber: (value: K) => void): void => {\n    let acc = (value: any) => subscriber(value)\n    operators\n      .slice()\n      .reverse()\n      .forEach(operator => {\n        const prevCallback = acc\n        acc = value => operator(value, prevCallback)\n      })\n    acc(value)\n  }\n}\n\nfunction buildPipe<T>(subscribe: TSubscribe<T>) {\n  function pipe(...operators: []): TObservable<T>\n  function pipe<R1>(...operators: [TOperator<T, R1>]): TObservable<R1>\n  function pipe<R1, R2>(...operators: [TOperator<T, R1>, TOperator<R1, R2>]): TObservable<R2>\n  function pipe<R1, R2, R3>(...operators: [TOperator<T, R1>, TOperator<R1, R2>, TOperator<R2, R3>]): TObservable<R3>\n  function pipe<R1, R2, R3, R4>(\n    ...operators: [TOperator<T, R1>, TOperator<R1, R2>, TOperator<R2, R3>, TOperator<R3, R4>]\n  ): TObservable<R4>\n  function pipe<K extends TOperator<any, any>[]>(...operators: K) {\n    const operator = combineOperators(...operators)\n    return observable(subscribe, operator)\n  }\n  return pipe\n}\n\nexport function observable<T, K>(source: TSubscribe<T>, operator: TOperator<T, K>) {\n  const subscribe = (subscriber: TSubscriber<K>) => {\n    return source(val => operator(val, subscriber))\n  }\n\n  return {\n    subscribe,\n    pipe: buildPipe(subscribe),\n  }\n}\n\nexport function subject<T>(initial?: T, distinct = true): TSubject<T> {\n  let subscribers: TSubscriber<T>[] = []\n  let val: T | undefined = initial\n\n  const next = (newVal: T) => {\n    if (!distinct || newVal !== val) {\n      val = newVal\n      subscribers.forEach(subscriber => subscriber(newVal))\n    }\n  }\n\n  const subscribe = (subscriber: TSubscriber<T>) => {\n    subscribers.push(subscriber)\n    if (val !== undefined) {\n      subscriber(val)\n    }\n    return () => {\n      subscribers = subscribers.filter(sub => sub !== subscriber)\n    }\n  }\n\n  return {\n    next,\n    subscribe,\n    pipe: buildPipe(subscribe),\n    subscribers,\n  }\n}\n\nexport function coldSubject<T>(): TSubject<T> {\n  let subscribers: TSubscriber<T>[] = []\n\n  const next = (newVal: T) => {\n    subscribers.forEach(subscriber => subscriber(newVal))\n  }\n\n  const subscribe = (subscriber: TSubscriber<T>) => {\n    subscribers.push(subscriber)\n    return () => {\n      subscribers = subscribers.filter(sub => sub !== subscriber)\n    }\n  }\n\n  return {\n    next,\n    subscribe,\n    pipe: buildPipe(subscribe),\n    subscribers,\n  }\n}\n\nexport function combineLatest<S1, S2>(s1: TObservable<S1>, s2: TObservable<S2>): TObservable<[S1, S2]>\nexport function combineLatest<S1, S2, S3>(\n  s1: TObservable<S1>,\n  s2: TObservable<S2>,\n  s3: TObservable<S3>\n): TObservable<[S1, S2, S3]>\nexport function combineLatest<S1, S2, S3, S4>(\n  s1: TObservable<S1>,\n  s2: TObservable<S2>,\n  s3: TObservable<S3>,\n  s4: TObservable<S4>\n): TObservable<[S1, S2, S3, S4]>\nexport function combineLatest<S1, S2, S3, S4, S5>(\n  s1: TObservable<S1>,\n  s2: TObservable<S2>,\n  s3: TObservable<S3>,\n  s4: TObservable<S4>,\n  s5: TObservable<S5>\n): TObservable<[S1, S2, S3, S4, S5]>\nexport function combineLatest<S1, S2, S3, S4, S5, S6>(\n  ...s: [TObservable<S1>, TObservable<S2>, TObservable<S3>, TObservable<S4>, TObservable<S5>, TObservable<S6>]\n): TObservable<[S1, S2, S3, S4, S5, S6]>\nexport function combineLatest<S1, S2, S3, S4, S5, S6, S7>(\n  s1: TObservable<S1>,\n  s2: TObservable<S2>,\n  s3: TObservable<S3>,\n  s4: TObservable<S4>,\n  s5: TObservable<S5>,\n  s6: TObservable<S6>,\n  s7: TObservable<S7>\n): TObservable<[S1, S2, S3, S4, S5, S6, S7]>\nexport function combineLatest<S1, S2, S3, S4, S5, S6, S7, S8>(\n  s1: TObservable<S1>,\n  s2: TObservable<S2>,\n  s3: TObservable<S3>,\n  s4: TObservable<S4>,\n  s5: TObservable<S5>,\n  s6: TObservable<S6>,\n  s7: TObservable<S7>,\n  s8: TObservable<S8>\n): TObservable<[S1, S2, S3, S4, S5, S6, S7, S8]>\nexport function combineLatest<S1, S2, S3, S4, S5, S6, S7, S8, S9>(\n  s1: TObservable<S1>,\n  s2: TObservable<S2>,\n  s3: TObservable<S3>,\n  s4: TObservable<S4>,\n  s5: TObservable<S5>,\n  s6: TObservable<S6>,\n  s7: TObservable<S7>,\n  s8: TObservable<S8>,\n  s9: TObservable<S9>\n): TObservable<[S1, S2, S3, S4, S5, S6, S7, S8, S9]>\nexport function combineLatest<S1, S2, S3, S4, S5, S6, S7, S8, S9, S10>(\n  s1: TObservable<S1>,\n  s2: TObservable<S2>,\n  s3: TObservable<S3>,\n  s4: TObservable<S4>,\n  s5: TObservable<S5>,\n  s6: TObservable<S6>,\n  s7: TObservable<S7>,\n  s8: TObservable<S8>,\n  s9: TObservable<S9>,\n  s10: TObservable<S10>\n): TObservable<[S1, S2, S3, S4, S5, S6, S7, S8, S9, S10]>\nexport function combineLatest<S1, S2, S3, S4, S5, S6, S7, S8, S9, S10, S11>(\n  s1: TObservable<S1>,\n  s2: TObservable<S2>,\n  s3: TObservable<S3>,\n  s4: TObservable<S4>,\n  s5: TObservable<S5>,\n  s6: TObservable<S6>,\n  s7: TObservable<S7>,\n  s8: TObservable<S8>,\n  s9: TObservable<S9>,\n  s10: TObservable<S10>,\n  s11: TObservable<S11>\n): TObservable<[S1, S2, S3, S4, S5, S6, S7, S8, S9, S10, S11]>\nexport function combineLatest(...sources: TObservable<any>[]): TObservable<any[]> {\n  const called = Array<boolean>(sources.length).fill(false)\n  const values = Array<any>(sources.length)\n  let subscribers: TSubscriber<any>[] = []\n\n  const publish = (subscribers: TSubscriber<any>[]) => {\n    called.every(isCalled => isCalled) && subscribers.forEach(subscriber => subscriber(values))\n  }\n\n  sources.forEach((source, index) => {\n    source.subscribe(val => {\n      called[index] = true\n      values[index] = val\n      publish(subscribers)\n    })\n  })\n\n  const subscribe = (subscriber: TSubscriber<any[]>) => {\n    subscribers.push(subscriber)\n    publish([subscriber])\n    return () => {\n      subscribers = subscribers.filter(sub => sub !== subscriber)\n    }\n  }\n\n  return { subscribe, pipe: buildPipe(subscribe) }\n}\n\nexport function map<T, K>(map: (val: T) => K): (val: T, subscriber: TSubscriber<K>) => void {\n  return (val: T, subscriber: TSubscriber<K>) => {\n    subscriber(map(val))\n  }\n}\n\nexport function mapTo<T>(val: T) {\n  return (_: any, done: TSubscriber<T>) => done(val)\n}\n\nexport function skip<T>(times: number) {\n  return (val: T, done: TSubscriber<T>) => {\n    if (times > 0) {\n      times--\n    } else {\n      done(val)\n    }\n  }\n}\n\nexport function filter<T>(predicate: (val: T) => boolean) {\n  return (val: T, done: TSubscriber<T>) => {\n    predicate(val) && done(val)\n  }\n}\n\nexport function duc<T>(comparator = (current: T, next: T) => current !== next) {\n  let current: T\n  return (next: T, done: TSubscriber<T>) => {\n    if (comparator(current, next)) {\n      current = next\n      done(next)\n    }\n  }\n}\n\nexport function debounceTime<T>(time: number) {\n  let val: T | undefined\n  let timeout: any\n\n  return (newVal: T, done: TSubscriber<T>) => {\n    val = newVal\n    if (timeout) {\n      clearTimeout(timeout)\n    }\n\n    timeout = setTimeout(() => {\n      done(val!)\n    }, time)\n  }\n}\n\nexport function throttleTime<T>(time: number) {\n  let val: T | undefined\n  let timeout: any\n\n  return (newVal: T, done: TSubscriber<T>) => {\n    val = newVal\n\n    if (timeout) {\n      return\n    }\n\n    timeout = setTimeout(() => {\n      timeout = undefined\n      done(val!)\n    }, time)\n  }\n}\n\nexport function scan<T, K>(scanner: (prevVal: T, current: K) => T, initialValue: T) {\n  let prevVal: T = initialValue\n  return (newVal: K, done: TSubscriber<T>) => {\n    done((prevVal = scanner(prevVal, newVal)))\n  }\n}\n\nexport function withLatestFrom<T, R1>(s1: TObservable<R1>): (val: T, done: TSubscriber<[T, R1]>) => void\nexport function withLatestFrom<T, R1, R2>(\n  s1: TObservable<R1>,\n  s2: TObservable<R2>\n): (val: T, done: TSubscriber<[T, R1, R2]>) => void\nexport function withLatestFrom<T, R1, R2, R3>(\n  s1: TObservable<R1>,\n  s2: TObservable<R2>,\n  s3: TObservable<R3>\n): (val: T, done: TSubscriber<[T, R1, R2, R3]>) => void\nexport function withLatestFrom<T, R1, R2, R3, R4>(\n  s1: TObservable<R1>,\n  s2: TObservable<R2>,\n  s3: TObservable<R3>,\n  s4: TObservable<R4>\n): (val: T, done: TSubscriber<[T, R1, R2, R3, R4]>) => void\nexport function withLatestFrom<T, R1, R2, R3, R4, R5>(\n  s1: TObservable<R1>,\n  s2: TObservable<R2>,\n  s3: TObservable<R3>,\n  s4: TObservable<R4>,\n  s5: TObservable<R5>\n): (val: T, done: TSubscriber<[T, R1, R2, R3, R4, R5]>) => void\nexport function withLatestFrom<T, R1, R2, R3, R4, R5, R6>(\n  s1: TObservable<R1>,\n  s2: TObservable<R2>,\n  s3: TObservable<R3>,\n  s4: TObservable<R4>,\n  s5: TObservable<R5>,\n  s6: TObservable<R6>\n): (val: T, done: TSubscriber<[T, R1, R2, R3, R4, R5, R6]>) => void\nexport function withLatestFrom<T, R1, R2, R3, R4, R5, R6, R7>(\n  s1: TObservable<R1>,\n  s2: TObservable<R2>,\n  s3: TObservable<R3>,\n  s4: TObservable<R4>,\n  s5: TObservable<R5>,\n  s6: TObservable<R6>,\n  s7: TObservable<R7>\n): (val: T, done: TSubscriber<[T, R1, R2, R3, R4, R5, R6, R7]>) => void\n\nexport function withLatestFrom<T>(...sources: TObservable<any>[]) {\n  const called = Array<boolean>(sources.length).fill(false)\n  const values = Array<any>(sources.length)\n  sources.forEach((source, index) => {\n    source.subscribe(val => {\n      values[index] = val\n      called[index] = true\n    })\n  })\n\n  return (val: T, done: TSubscriber<any>) => {\n    called.every(isCalled => isCalled) && done([val, ...values])\n  }\n}\n","import { debounceTime, mapTo, skip, subject, TObservable, duc } from './tinyrx'\n\ninterface TScrollLocationWithAlign {\n  index: number\n  align: 'start' | 'center' | 'end'\n  behavior?: 'smooth' | 'auto'\n}\n\nexport type TScrollLocation = number | TScrollLocationWithAlign\n\nexport const buildIsScrolling = (scrollTop$: TObservable<number>): TObservable<boolean> => {\n  const isScrolling$ = subject(false)\n\n  scrollTop$.pipe(skip(1), duc(), mapTo(true)).subscribe(isScrolling$.next)\n\n  scrollTop$.pipe(skip(1), mapTo(false), debounceTime(200)).subscribe(isScrolling$.next)\n\n  return isScrolling$\n}\n","import { TObservable, withLatestFrom, coldSubject, TSubject, subject } from '../tinyrx'\nimport { OffsetList } from '../OffsetList'\n\ninterface AdjustForPrependedItemsParams {\n  offsetList$: TSubject<OffsetList>\n  scrollTop$: TObservable<number>\n  scrollTo$: TSubject<ScrollToOptions>\n}\n\nexport function adjustForPrependedItemsEngine({ offsetList$, scrollTop$, scrollTo$ }: AdjustForPrependedItemsParams) {\n  const adjustForPrependedItems$ = coldSubject<number>()\n\n  const adjustmentInProgress$ = subject(false)\n  adjustForPrependedItems$\n    .pipe(withLatestFrom(offsetList$, scrollTop$, adjustmentInProgress$))\n    .subscribe(([count, offsetList, scrollTop, inProgress]) => {\n      if (inProgress || offsetList.empty()) {\n        return\n      }\n\n      adjustmentInProgress$.next(true)\n      offsetList$.next(offsetList.adjustForPrependedItems(count))\n\n      setTimeout(() => {\n        scrollTo$.next({ top: count * offsetList.getDefaultSize() + scrollTop })\n        adjustmentInProgress$.next(false)\n      })\n    })\n\n  return { adjustForPrependedItems$, adjustmentInProgress$ }\n}\n","import { TScrollLocation } from '../EngineCommons'\nimport { TObservable, TSubject, subject, combineLatest, withLatestFrom } from '../tinyrx'\n\ninterface FollowOutputParams {\n  totalCount$: TObservable<number>\n  scrolledToBottom$: TSubject<boolean>\n  scrollToIndex$: TSubject<TScrollLocation>\n}\nexport function followOutputEngine({ scrollToIndex$, scrolledToBottom$, totalCount$ }: FollowOutputParams) {\n  const followOutput$ = subject(false)\n\n  combineLatest(followOutput$, totalCount$)\n    .pipe(withLatestFrom(scrolledToBottom$))\n    .subscribe(([[followOutput, totalCount], scrolledToBottom]) => {\n      if (followOutput && scrolledToBottom) {\n        setTimeout(() => {\n          scrollToIndex$.next({ index: totalCount - 1, align: 'end', behavior: 'auto' })\n        })\n      }\n    })\n  return {\n    followOutput$,\n  }\n}\n","interface NodeData<T> {\n  key: number\n  value: T\n}\n\ninterface Range<T> {\n  start: number\n  end: number\n  value: T\n}\n\ntype FindCallback<T> = (value: T) => 1 | 0 | -1\n\nexport type NodeIterator<T> = IterableIterator<NodeData<T>>\nexport type RangeIterator<T> = IterableIterator<Range<T>>\n\nclass NilNode<T> {\n  public level = 0\n\n  public rebalance(): this {\n    return this\n  }\n\n  public adjust(): this {\n    return this\n  }\n\n  public shift(): this {\n    return this\n  }\n\n  public remove(): this {\n    return this\n  }\n\n  public find(): undefined {\n    return\n  }\n\n  public findWith(): undefined {\n    return\n  }\n\n  public findMax(): number {\n    return -Infinity\n  }\n\n  public findMaxValue(): undefined {\n    return\n  }\n\n  public insert(key: number, value: T): NonNilNode<T> {\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    return new NonNilNode<T>({ key, value, level: 1 })\n  }\n\n  public walkWithin(): NodeData<T>[] {\n    return []\n  }\n\n  public walk(): NodeData<T>[] {\n    return []\n  }\n\n  public ranges<T>(): Range<T>[] {\n    return []\n  }\n\n  public rangesWithin<T>(): Range<T>[] {\n    return []\n  }\n\n  public empty(): this is NilNode<T> {\n    return true\n  }\n\n  public isSingle(): true {\n    return true\n  }\n\n  public isInvariant(): true {\n    return true\n  }\n\n  public keys(): number[] {\n    return []\n  }\n}\n\nconst NIL_NODE = new NilNode()\n\nObject.freeze(NIL_NODE)\n\ntype Node<T> = NonNilNode<T> | NilNode<T>\n\ninterface NodeConstructorArgs<T> {\n  key: number\n  value: T\n  level: number\n  left?: Node<T>\n  right?: Node<T>\n}\n\nclass UnreachableCaseError extends Error {\n  constructor(val: never) {\n    super(`Unreachable case: ${val}`)\n  }\n}\n\nclass NonNilNode<T> {\n  public key: number\n  public value: T\n  public level: number\n  public left: Node<T>\n  public right: Node<T>\n\n  public constructor({\n    key,\n    value,\n    level,\n    left = NIL_NODE as NilNode<T>,\n    right = NIL_NODE as NilNode<T>,\n  }: NodeConstructorArgs<T>) {\n    this.key = key\n    this.value = value\n    this.level = level\n    this.left = left\n    this.right = right\n  }\n\n  public shift(amount: number): Node<T> {\n    return this.clone({\n      key: this.key + amount,\n      left: this.left.shift(amount),\n      right: this.right.shift(amount),\n    })\n  }\n\n  public remove(key: number): Node<T> {\n    const { left, right } = this\n\n    if (key === this.key) {\n      if (left.empty()) {\n        return right\n      } else if (right.empty()) {\n        return left\n      } else {\n        const [lastKey, lastValue] = left.last()\n        return this.clone({\n          key: lastKey,\n          value: lastValue,\n          left: left.deleteLast(),\n        }).adjust()\n      }\n    } else if (key < this.key) {\n      return this.clone({\n        left: left.remove(key),\n      }).adjust()\n    } else {\n      return this.clone({\n        right: right.remove(key),\n      }).adjust()\n    }\n  }\n\n  public empty(): this is NilNode<T> {\n    return false\n  }\n\n  public find(key: number): T | undefined {\n    if (key === this.key) {\n      return this.value\n    } else if (key < this.key) {\n      return this.left.find(key)\n    } else {\n      return this.right.find(key)\n    }\n  }\n\n  public findWith(callback: FindCallback<T>): [number, T] | undefined {\n    const result = callback(this.value)\n\n    switch (result) {\n      case -1:\n        return this.left.findWith(callback)\n      case 0:\n        return [this.key, this.value]\n      case 1:\n        return this.right.findWith(callback)\n      default:\n        throw new UnreachableCaseError(result)\n    }\n  }\n\n  public findMax(key: number): number {\n    if (this.key === key) {\n      return key\n    }\n\n    if (this.key < key) {\n      const rightKey = this.right.findMax(key)\n      if (rightKey === -Infinity) {\n        return this.key\n      } else {\n        return rightKey\n      }\n    }\n\n    return this.left.findMax(key)\n  }\n\n  public findMaxValue(key: number): T {\n    if (this.key === key) {\n      return this.value\n    }\n\n    if (this.key < key) {\n      const rightValue = this.right.findMaxValue(key)\n      if (rightValue === undefined) {\n        return this.value\n      } else {\n        return rightValue\n      }\n    }\n\n    return this.left.findMaxValue(key)!\n  }\n\n  public insert(key: number, value: T): NonNilNode<T> {\n    if (key === this.key) {\n      return this.clone({ key, value })\n    } else if (key < this.key) {\n      return this.clone({\n        left: this.left.insert(key, value),\n      }).rebalance()\n    } else {\n      return this.clone({\n        right: this.right.insert(key, value),\n      }).rebalance()\n    }\n  }\n\n  public walkWithin(start: number, end: number): NodeData<T>[] {\n    const { key, value } = this\n    let result: NodeData<T>[] = []\n    if (key > start) {\n      result = result.concat(this.left.walkWithin(start, end))\n    }\n\n    if (key >= start && key <= end) {\n      result.push({ key, value })\n    }\n\n    if (key <= end) {\n      result = result.concat(this.right.walkWithin(start, end))\n    }\n\n    return result\n  }\n\n  public walk(): NodeData<T>[] {\n    return [...this.left.walk(), { key: this.key, value: this.value }, ...this.right.walk()]\n  }\n\n  public last(): [number, T] {\n    if (this.right.empty()) {\n      return [this.key, this.value]\n    } else {\n      return this.right.last()\n    }\n  }\n\n  public deleteLast(): Node<T> {\n    if (this.right.empty()) {\n      return this.left\n    } else {\n      return this.clone({\n        right: this.right.deleteLast(),\n      }).adjust()\n    }\n  }\n\n  public clone(args: Partial<NodeConstructorArgs<T>>): NonNilNode<T> {\n    return new NonNilNode<T>({\n      key: args.key !== undefined ? args.key : this.key,\n      value: args.value !== undefined ? args.value : this.value,\n      level: args.level !== undefined ? args.level : this.level,\n      left: args.left !== undefined ? args.left : this.left,\n      right: args.right !== undefined ? args.right : this.right,\n    })\n  }\n\n  public isSingle(): boolean {\n    return this.level > this.right.level\n  }\n\n  public rebalance(): NonNilNode<T> {\n    return this.skew().split()\n  }\n\n  public adjust(): NonNilNode<T> {\n    const { left, right, level } = this\n    if (right.level >= level - 1 && left.level >= level - 1) {\n      return this\n    } else if (level > right.level + 1) {\n      if (left.isSingle()) {\n        return this.clone({ level: level - 1 }).skew()\n      } else {\n        if (!left.empty() && !left.right.empty()) {\n          return left.right.clone({\n            left: left.clone({ right: left.right.left }),\n            right: this.clone({\n              left: left.right.right,\n              level: level - 1,\n            }),\n            level: level,\n          })\n        } else {\n          throw new Error('Unexpected empty nodes')\n        }\n      }\n    } else {\n      if (this.isSingle()) {\n        return this.clone({ level: level - 1 }).split()\n      } else {\n        if (!right.empty() && !right.left.empty()) {\n          const rl = right.left\n          const rightLevel = rl.isSingle() ? right.level - 1 : right.level\n\n          return rl.clone({\n            left: this.clone({\n              right: rl.left,\n              level: level - 1,\n            }),\n            right: right.clone({ left: rl.right, level: rightLevel }).split(),\n            level: rl.level + 1,\n          })\n        } else {\n          throw new Error('Unexpected empty nodes')\n        }\n      }\n    }\n  }\n\n  public isInvariant(): boolean {\n    const { left, right, level } = this\n\n    if (level !== left.level + 1) {\n      return false\n    } else if (level !== right.level && level !== right.level + 1) {\n      return false\n    } else if (!right.empty() && level <= right.right.level) {\n      return false\n    } else {\n      return left.isInvariant() && right.isInvariant()\n    }\n  }\n\n  public keys(): number[] {\n    return [...this.left.keys(), this.key, ...this.right.keys()]\n  }\n\n  public ranges(): Range<T>[] {\n    return this.toRanges(this.walk())\n  }\n\n  public rangesWithin(startIndex: number, endIndex: number): Range<T>[] {\n    return this.toRanges(this.walkWithin(startIndex, endIndex))\n  }\n\n  private toRanges(nodes: NodeData<T>[]): Range<T>[] {\n    if (nodes.length === 0) {\n      return []\n    }\n\n    const first = nodes[0]\n\n    let { key: start, value } = first\n\n    const result = []\n\n    for (let i = 1; i <= nodes.length; i++) {\n      const nextNode = nodes[i]\n      const end = nextNode ? nextNode.key - 1 : Infinity\n      result.push({ start, end, value })\n\n      if (nextNode) {\n        start = nextNode.key\n        value = nextNode.value\n      }\n    }\n    return result\n  }\n\n  private split(): NonNilNode<T> {\n    const { right, level } = this\n    if (!right.empty() && !right.right.empty() && right.level === level && right.right.level === level) {\n      return right.clone({\n        left: this.clone({ right: right.left }),\n        level: level + 1,\n      })\n    } else {\n      return this\n    }\n  }\n\n  private skew(): NonNilNode<T> {\n    const { left } = this\n\n    if (!left.empty() && left.level === this.level) {\n      return left.clone({\n        right: this.clone({ left: left.right }),\n      })\n    } else {\n      return this\n    }\n  }\n}\n\nexport class AATree<T> {\n  private root: Node<T>\n\n  public static empty<T>(): AATree<T> {\n    return new AATree<T>(NIL_NODE as NilNode<T>)\n  }\n\n  private constructor(root: Node<T>) {\n    this.root = root\n  }\n\n  public find(key: number): T | undefined {\n    return this.root.find(key)\n  }\n\n  public findMax(key: number): number {\n    return this.root.findMax(key)\n  }\n\n  public findMaxValue(key: number): T {\n    if (this.empty()) {\n      throw new Error('Searching for max value in an empty tree')\n    }\n    return this.root.findMaxValue(key)!\n  }\n\n  public findWith(callback: FindCallback<T>): [number, T] | void {\n    return this.root.findWith(callback)\n  }\n\n  public insert(key: number, value: T): AATree<T> {\n    return new AATree(this.root.insert(key, value))\n  }\n\n  public remove(key: number): AATree<T> {\n    return new AATree(this.root.remove(key))\n  }\n\n  public shift(amount: number) {\n    if (this.empty()) {\n      return this\n    }\n    const defaultValue = this.root.findMaxValue(Infinity)\n    return new AATree(this.root.shift(amount).insert(0, defaultValue!))\n  }\n\n  public empty() {\n    return this.root.empty()\n  }\n\n  public keys(): number[] {\n    return this.root.keys()\n  }\n\n  public walk(): NodeData<T>[] {\n    return this.root.walk()\n  }\n\n  public walkWithin(start: number, end: number): NodeData<T>[] {\n    const adjustedStart = this.root.findMax(start)\n    return this.root.walkWithin(adjustedStart, end)\n  }\n\n  public ranges(): Range<T>[] {\n    return this.root.ranges()\n  }\n\n  public rangesWithin(start: number, end: number): Range<T>[] {\n    const adjustedStart = this.root.findMax(start)\n    return this.root.rangesWithin(adjustedStart, end)\n  }\n\n  public isInvariant(): boolean {\n    return this.root.isInvariant()\n  }\n}\n","import { AATree } from './AATree'\nimport { Item } from './OffsetList'\n\nexport interface RecordItem extends Item {\n  type: 'item'\n  transposedIndex: number\n  groupIndex: number\n}\n\nexport interface GroupItem extends Item {\n  type: 'group'\n  groupIndex: number\n}\n\nexport type ListItem = RecordItem | GroupItem\n\nexport class StubIndexTransposer {\n  public transpose(items: Item[]): RecordItem[] {\n    return items.map(item => {\n      return {\n        groupIndex: 0,\n        index: item.index,\n        offset: item.offset,\n        size: item.size,\n        transposedIndex: item.index,\n        type: 'item',\n      }\n    })\n  }\n}\n\nexport class GroupIndexTransposer {\n  public tree: AATree<[number, number]>\n  private count: number\n\n  public constructor(counts: number[]) {\n    this.count = counts.reduce((acc, groupCount) => acc + groupCount + 1, 0)\n    let tree = AATree.empty<[number, number]>()\n    let groupIndex = 0\n    let total = 0\n    for (const groupCount of counts) {\n      tree = tree.insert(total, [groupIndex, total])\n      groupIndex++\n      total += groupCount + 1\n    }\n    this.tree = tree\n  }\n\n  public totalCount(): number {\n    return this.count\n  }\n\n  public transpose(items: Item[]): ListItem[] {\n    return items.map(item => {\n      const groupMatch = this.tree.find(item.index)\n      if (groupMatch) {\n        return {\n          groupIndex: groupMatch[0],\n          index: item.index,\n          offset: item.offset,\n          size: item.size,\n          type: 'group',\n        }\n      }\n\n      const [groupIndex] = this.tree.findMaxValue(item.index)!\n      return {\n        groupIndex: groupIndex,\n        index: item.index,\n        offset: item.offset,\n        size: item.size,\n        transposedIndex: item.index - groupIndex - 1,\n        type: 'item',\n      }\n    })\n  }\n\n  public groupIndices() {\n    return this.tree.keys()\n  }\n}\n\nexport type Transposer = StubIndexTransposer | GroupIndexTransposer\n","import { GroupIndexTransposer, Transposer } from '../GroupIndexTransposer'\nimport { TSubject, subject } from '../tinyrx'\n\ninterface GroupCountParams {\n  totalCount$: TSubject<number>\n  stickyItems$: TSubject<number[]>\n  transposer$: TSubject<Transposer>\n}\nexport function groupCountEngine({ transposer$, stickyItems$, totalCount$ }: GroupCountParams) {\n  const groupCounts$ = subject<number[]>()\n  const groupIndices$ = stickyItems$.pipe()\n\n  groupCounts$.subscribe(counts => {\n    const transposer = new GroupIndexTransposer(counts)\n    transposer$.next(transposer)\n    totalCount$.next(transposer.totalCount())\n    stickyItems$.next(transposer.groupIndices())\n  })\n\n  return {\n    groupCounts$,\n    groupIndices$,\n  }\n}\n","import { scan, combineLatest, TObservable, map, subject, withLatestFrom, coldSubject, duc } from '../tinyrx'\nimport { OffsetList } from '../OffsetList'\nimport { ListItem, Transposer } from '../GroupIndexTransposer'\n\nexport const getListTop = (items: ListItem[]) => (items.length > 0 ? items[0].offset : 0)\n\ninterface ListEngineParams {\n  overscan: number\n  viewportHeight$: TObservable<number>\n  scrollTop$: TObservable<number>\n  topListHeight$: TObservable<number>\n  footerHeight$: TObservable<number>\n  minListIndex$: TObservable<number>\n  totalCount$: TObservable<number>\n  offsetList$: TObservable<OffsetList>\n  scrolledToTopMostItem$: TObservable<boolean>\n  transposer$: TObservable<Transposer>\n  totalHeight$: TObservable<number>\n}\n\nexport function listEngine({\n  overscan,\n  viewportHeight$,\n  scrollTop$,\n  topListHeight$,\n  footerHeight$,\n  minListIndex$,\n  totalCount$,\n  offsetList$,\n  scrolledToTopMostItem$,\n  transposer$,\n  totalHeight$,\n}: ListEngineParams) {\n  const listHeight$ = subject(0)\n  const endReached$ = coldSubject<number>()\n  const list$ = subject<ListItem[]>([])\n\n  const constrainedScrollTop$ = subject(0)\n\n  combineLatest(scrollTop$, totalHeight$, viewportHeight$)\n    .pipe(\n      map(([scrollTop, totalHeight, viewportHeight]) => Math.max(0, Math.min(scrollTop, totalHeight - viewportHeight)))\n    )\n    .subscribe(constrainedScrollTop$.next)\n\n  combineLatest(\n    viewportHeight$,\n    constrainedScrollTop$,\n    topListHeight$,\n    listHeight$,\n    footerHeight$,\n    minListIndex$,\n    totalCount$,\n    offsetList$,\n    scrolledToTopMostItem$,\n    transposer$\n  )\n    .pipe(\n      scan(\n        (\n          items,\n          [\n            viewportHeight,\n            scrollTop,\n            topListHeight,\n            listHeight,\n            footerHeight,\n            minIndex,\n            totalCount,\n            offsetList,\n            scrolledToTopMostItem,\n            transposer,\n          ]\n        ) => {\n          const itemLength = items.length\n\n          if (totalCount === 0) {\n            return []\n          }\n\n          const listTop = getListTop(items)\n\n          const listBottom = listTop - scrollTop + listHeight - footerHeight - topListHeight\n          const maxIndex = Math.max(totalCount - 1, 0)\n          const indexOutOfAllowedRange =\n            itemLength > 0 && (items[0].index < minIndex || items[itemLength - 1].index > maxIndex)\n\n          if (listBottom < viewportHeight || indexOutOfAllowedRange) {\n            const endOffset = scrollTop + viewportHeight + overscan * 2 - 1\n            items = transposer.transpose(offsetList.range(scrollTop, endOffset, minIndex, maxIndex))\n          }\n\n          if (listTop > scrollTop) {\n            const startOffset = Math.max(scrollTop - overscan * 2, 0)\n            const endOffset = scrollTop + viewportHeight - 1\n            items = transposer.transpose(offsetList.range(startOffset, endOffset, minIndex, maxIndex))\n          }\n\n          // this is a hack - we should let the probe item render,\n          // but skip the real list until the viewport has scrolled\n          // to the expected location\n          if (items.length > 1 && !scrolledToTopMostItem) {\n            return []\n          }\n\n          return items\n        },\n        [] as ListItem[]\n      ),\n      duc()\n    )\n    .subscribe(list$.next)\n\n  const listOffset$ = combineLatest(list$, scrollTop$, topListHeight$).pipe(map(([items]) => getListTop(items)))\n\n  let currentEndIndex = 0\n\n  list$\n    .pipe(map(items => (items.length ? items[items.length - 1].index : 0)))\n    .pipe(withLatestFrom(totalCount$))\n    .subscribe(([endIndex, totalCount]) => {\n      if (totalCount === 0) {\n        return\n      }\n\n      if (endIndex === totalCount - 1) {\n        if (currentEndIndex !== endIndex) {\n          currentEndIndex = endIndex\n          endReached$.next(endIndex)\n        }\n      }\n    })\n\n  return { list$, listOffset$, listHeight$, endReached$ }\n}\n","import { TObservable, TSubject, subject, withLatestFrom } from '../tinyrx'\nimport { OffsetList } from '../OffsetList'\nimport { ListItem } from '../GroupIndexTransposer'\n\nexport interface MaxRangeSizeParams {\n  offsetList$: TSubject<OffsetList>\n  scrollTo$: TSubject<ScrollToOptions>\n  scrollTop$: TObservable<number>\n  list$: TObservable<ListItem[]>\n}\n\nexport function maxRangeSizeEngine({ list$, offsetList$, scrollTop$, scrollTo$ }: MaxRangeSizeParams) {\n  const scheduledReadjust$ = subject<{ index: number; offset: number } | null>(null)\n  const maxRangeSize$ = subject(Infinity)\n\n  //////////////\n  // Max range size implementation\n  // the scheduledReadjust$ can be removed through the trapNext pattern\n  //////////////\n\n  // 1. List warns us that it will reset itself.\n  offsetList$\n    .pipe(withLatestFrom(maxRangeSize$, scrollTop$, list$))\n    .subscribe(([offsetList, maxRangeSize, scrollTop, list]) =>\n      offsetList.configureMaxRangeSize(maxRangeSize, () => {\n        // 2. we pick the adjustment signal and capture the list state *before* it gets reset\n        scheduledReadjust$.next({ index: list[0].index, offset: scrollTop - list[0].offset })\n      })\n    )\n\n  // 3. once the offset list is reset, we compensate the scroll.\n  offsetList$.pipe(withLatestFrom(scheduledReadjust$)).subscribe(([offsetList, adjust]) => {\n    if (adjust !== null) {\n      const scrollTo = offsetList.offsetOf(adjust!.index) + adjust!.offset\n      scrollTo$.next({ top: scrollTo })\n      scheduledReadjust$.next(null)\n    }\n  })\n  return {\n    maxRangeSize$,\n  }\n}\n","import { AATree } from './AATree'\n\ninterface OffsetValue {\n  startIndex: number\n  endIndex: number\n  size: number\n}\n\nexport interface Item {\n  index: number\n  offset: number\n  size: number\n}\n\nexport class OffsetList {\n  public rangeTree: AATree<number>\n  public offsetTree: AATree<OffsetValue>\n  private nanIndices: number[]\n  private initialTopMostItemIndex = 0\n  private rangeSize = 0\n  private maxRangeSize = Infinity\n  private rangeSizeExceededCallback: () => void = () => {}\n\n  public static create(): OffsetList {\n    return new OffsetList(AATree.empty<number>())\n  }\n\n  private constructor(\n    rangeTree: AATree<number>,\n    offsetTree = AATree.empty<OffsetValue>(),\n    nanIndices: number[] = [],\n    initialTopMostItemIndex = 0\n  ) {\n    this.rangeTree = rangeTree\n    this.nanIndices = nanIndices\n    this.initialTopMostItemIndex = initialTopMostItemIndex\n\n    if (offsetTree.empty()) {\n      let offset = 0\n      const ranges = rangeTree.ranges()\n\n      let nanFound = false\n\n      for (const { start: startIndex, end: endIndex, value: size } of ranges) {\n        this.rangeSize++\n        if (isNaN(size)) {\n          this.nanIndices.push(startIndex)\n\n          if (!nanFound) {\n            offsetTree = offsetTree.insert(offset, {\n              startIndex,\n              endIndex: Infinity,\n              size,\n            })\n          }\n\n          nanFound = true\n        } else if (!nanFound) {\n          offsetTree = offsetTree.insert(offset, {\n            startIndex,\n            endIndex: endIndex,\n            size,\n          })\n\n          offset += (endIndex - startIndex + 1) * size\n        }\n      }\n    }\n\n    this.offsetTree = offsetTree\n  }\n\n  public empty() {\n    return this.rangeTree.empty()\n  }\n\n  private fromTree(tree: AATree<number>) {\n    return new OffsetList(tree, undefined, undefined, this.initialTopMostItemIndex)\n  }\n\n  public insert(start: number, end: number, size: number): OffsetList {\n    let tree = this.rangeTree\n    if (tree.empty()) {\n      return this.fromTree(tree.insert(0, size))\n    }\n\n    if (this.rangeSize > this.maxRangeSize) {\n      this.rangeSizeExceededCallback()\n      return this.fromTree(AATree.empty<number>().insert(0, this.getDefaultSize()))\n    }\n\n    // tree is in non-complete state - we know the group sizes, but not the item sizes\n    if (this.nanIndices.length && this.nanIndices.indexOf(end) > -1) {\n      const groupSize = tree.find(this.nanIndices[0] - 1)\n\n      if (groupSize === size) {\n        return this.fromTree(AATree.empty<number>().insert(0, size))\n      }\n      for (const nanIndex of this.nanIndices) {\n        tree = tree.insert(nanIndex, size)\n      }\n\n      return this.fromTree(tree)\n    }\n\n    // extend the range in both directions, so that we can get adjacent neighbours.\n    // if the previous / next ones have the same value as the one we are about to insert,\n    // we 'merge' them.\n    const overlapingRanges = tree.rangesWithin(start - 1, end + 1)\n\n    if (\n      overlapingRanges.some(range => {\n        return range.start === start && (range.end === end || range.end === Infinity) && range.value === size\n      })\n    ) {\n      return this\n    }\n\n    let firstPassDone = false\n    let shouldInsert = false\n    for (const { start: rangeStart, end: rangeEnd, value: rangeValue } of overlapingRanges) {\n      // previous range\n      if (!firstPassDone) {\n        shouldInsert = rangeValue !== size\n        firstPassDone = true\n      } else {\n        // remove the range if it starts within the new range OR if\n        // it has the same value as it, in order to perfrom a merge\n        if (end >= rangeStart || size === rangeValue) {\n          tree = tree.remove(rangeStart)\n        }\n      }\n\n      // next range\n      if (rangeEnd > end && end >= rangeStart) {\n        if (rangeValue !== size && !isNaN(rangeValue)) {\n          tree = tree.insert(end + 1, rangeValue)\n        }\n      }\n    }\n\n    if (shouldInsert) {\n      tree = tree.insert(start, size)\n    }\n\n    return tree === this.rangeTree ? this : this.fromTree(tree)\n  }\n\n  public insertSpots(spotIndexes: number[], value: number): OffsetList {\n    if (this.empty()) {\n      let tree = this.rangeTree\n      for (const spot of spotIndexes) {\n        tree = tree.insert(spot, value).insert(spot + 1, NaN)\n      }\n\n      return new OffsetList(tree)\n    } else {\n      throw new Error('attempting to overwrite non-empty tree')\n    }\n  }\n\n  public offsetOf(index: number): number {\n    if (this.offsetTree.empty()) {\n      return 0\n    }\n\n    const find = (value: OffsetValue) => {\n      if (value.startIndex > index) return -1\n      if (value.endIndex < index) return 1\n      return 0\n    }\n\n    const offsetRange = this.offsetTree.findWith(find)\n    if (offsetRange) {\n      const [offset, { startIndex, size }] = offsetRange\n      return offset + (index - startIndex) * size\n    } else {\n      throw new Error(`Requested offset outside of the known ones, index: ${index}`)\n    }\n  }\n\n  public itemAt(index: number): Item {\n    const size = this.rangeTree.findMaxValue(index)\n    return { index, size, offset: NaN }\n  }\n\n  public indexRange(startIndex: number, endIndex: number): Item[] {\n    if (this.rangeTree.empty()) {\n      return [{ index: this.initialTopMostItemIndex, size: 0, offset: NaN }]\n    }\n\n    const ranges = this.rangeTree.rangesWithin(startIndex, endIndex)\n    const result: Item[] = []\n\n    for (const range of ranges) {\n      const start = Math.max(startIndex, range.start)\n      const rangeEnd = typeof range.end === 'undefined' ? Infinity : range.end\n      const end = Math.min(endIndex, rangeEnd)\n\n      for (let i = start; i <= end; i++) {\n        result.push({ index: i, size: range.value, offset: NaN })\n      }\n    }\n    return result\n  }\n\n  public range(startOffset: number, endOffset: number, minIndex = 0, maxIndex = Infinity): Item[] {\n    if (this.offsetTree.empty()) {\n      return [{ index: this.initialTopMostItemIndex, size: 0, offset: 0 }]\n    }\n\n    const ranges = this.offsetTree.rangesWithin(startOffset, endOffset)\n\n    const result: Item[] = []\n\n    for (let {\n      start: rangeOffset,\n      value: { startIndex: rangeIndex, endIndex, size },\n    } of ranges) {\n      let offset = rangeOffset\n      let startIndex = rangeIndex\n\n      if (rangeOffset < startOffset) {\n        startIndex += Math.floor((startOffset - rangeOffset) / size)\n        offset += (startIndex - rangeIndex) * size\n      }\n\n      if (startIndex < minIndex) {\n        offset += (minIndex - startIndex) * size\n        startIndex = minIndex\n      }\n\n      // we don't know the size of this range - terminate with a probe item\n      if (isNaN(size)) {\n        result.push({ index: startIndex, size: 0, offset })\n        return result\n      }\n\n      endIndex = Math.min(endIndex, maxIndex)\n\n      for (let i = startIndex; i <= endIndex; i++) {\n        if (offset > endOffset) {\n          break\n        }\n\n        result.push({ index: i, size, offset })\n        offset += size\n      }\n    }\n    return result\n  }\n\n  public total(endIndex: number) {\n    const ranges = this.rangeTree.rangesWithin(0, endIndex)\n\n    let total = 0\n\n    for (let { start, end, value: size } of ranges) {\n      end = Math.min(end, endIndex)\n      total += (end - start + 1) * (isNaN(size) ? 0 : size)\n    }\n\n    return total\n  }\n\n  public getOffsets(indices: number[]): IndexList {\n    let tree = AATree.empty<number>()\n    indices.forEach(index => {\n      const offset = this.offsetOf(index)\n      tree = tree.insert(offset, index)\n    })\n    return new IndexList(tree)\n  }\n\n  public setInitialIndex(topMostItemIndex: number): OffsetList {\n    return new OffsetList(this.rangeTree, this.offsetTree, this.nanIndices, topMostItemIndex)\n  }\n\n  public getDefaultSize(): number {\n    return this.rangeTree.findMaxValue(Infinity)\n  }\n\n  public adjustForPrependedItems(count: number) {\n    return this.fromTree(this.rangeTree.shift(count))\n  }\n\n  public configureMaxRangeSize(maxRangeSize: number, maxRangeSizeExceededCallback: () => void) {\n    this.maxRangeSize = maxRangeSize\n    this.rangeSizeExceededCallback = maxRangeSizeExceededCallback\n  }\n}\n\nexport class IndexList {\n  public tree: AATree<number>\n  public constructor(tree: AATree<number>) {\n    this.tree = tree\n  }\n\n  public findMaxValue(offset: number): number {\n    return this.tree.findMaxValue(offset)\n  }\n\n  public empty(): boolean {\n    return this.tree.empty()\n  }\n}\n","import { subject, TSubject } from '../tinyrx'\nimport { ItemHeight } from '../VirtuosoStore'\n\ninterface InitialItemCountEngineParams {\n  itemHeights$: TSubject<ItemHeight[]>\n  viewportHeight$: TSubject<number>\n}\nexport function initialItemCountEngine({ itemHeights$, viewportHeight$ }: InitialItemCountEngineParams) {\n  const initialItemCount$ = subject<number>()\n  const pendingRenderAfterInitial$ = subject(false)\n\n  const unsubscribeInitial = initialItemCount$.subscribe(count => {\n    const dummyItemHeight = 30\n    itemHeights$.next([{ start: 0, end: 0, size: dummyItemHeight }])\n    viewportHeight$.next(dummyItemHeight * count)\n    pendingRenderAfterInitial$.next(true)\n    unsubscribeInitial()\n  })\n\n  return { initialItemCount$, pendingRenderAfterInitial$ }\n}\n","import { subject, map, TObservable, combineLatest, filter, withLatestFrom, TSubject } from '../tinyrx'\nimport { OffsetList } from '../OffsetList'\nimport { Transposer, ListItem } from '../GroupIndexTransposer'\n\ninterface StickyItemsEngineParams {\n  offsetList$: TObservable<OffsetList>\n  scrollTop$: TObservable<number>\n  topList$: TSubject<ListItem[]>\n  transposer$: TObservable<Transposer>\n}\nexport function stickyItemsEngine({ offsetList$, scrollTop$, topList$, transposer$ }: StickyItemsEngineParams) {\n  const stickyItems$ = subject<number[]>([])\n\n  const stickyItemsIndexList$ = combineLatest(offsetList$, stickyItems$).pipe(\n    map(([offsetList, stickyItems]) => {\n      return offsetList.getOffsets(stickyItems)\n    })\n  )\n\n  combineLatest(offsetList$, stickyItemsIndexList$, scrollTop$)\n    .pipe(\n      filter(params => !params[1].empty() && !params[0].empty()),\n      withLatestFrom(topList$, transposer$),\n      map(([[offsetList, stickyItemsIndexList, scrollTop], topList, transposer]) => {\n        const currentStickyItem = stickyItemsIndexList.findMaxValue(Math.max(scrollTop, 0))\n\n        if (topList.length === 1 && topList[0].index === currentStickyItem) {\n          return topList\n        }\n\n        const item = offsetList.itemAt(currentStickyItem)\n        return transposer.transpose([item])\n      })\n    )\n    .subscribe(topList$.next)\n\n  return {\n    stickyItems$,\n  }\n}\n","import { OffsetList } from '../OffsetList'\nimport { combineLatest, map, subject, TSubject, withLatestFrom, coldSubject } from '../tinyrx'\nimport { ItemHeight } from '../VirtuosoStore'\nimport { initialItemCountEngine } from './initialItemCountEngine'\nimport { Transposer, ListItem } from '../GroupIndexTransposer'\nimport { stickyItemsEngine } from './stickyItemsEngine'\n\ninterface OffsetListEngineParams {\n  itemHeight: number | undefined\n  defaultItemHeight: number | undefined\n  initialTopMostItemIndex: number | undefined\n  totalCount: number\n  viewportHeight$: TSubject<number>\n  scrollTop$: TSubject<number>\n  topList$: TSubject<ListItem[]>\n  transposer$: TSubject<Transposer>\n}\n\nexport function offsetListEngine({\n  totalCount,\n  itemHeight,\n  defaultItemHeight,\n  initialTopMostItemIndex,\n  viewportHeight$,\n  scrollTop$,\n  topList$,\n  transposer$,\n}: OffsetListEngineParams) {\n  const footerHeight$ = subject(0)\n  const totalCount$ = subject(totalCount)\n  const itemHeights$ = subject<ItemHeight[]>()\n  const { pendingRenderAfterInitial$, initialItemCount$ } = initialItemCountEngine({ itemHeights$, viewportHeight$ })\n  const heightsChanged$ = coldSubject<[boolean, OffsetList]>()\n\n  let initialOffsetList = OffsetList.create()\n\n  if (itemHeight) {\n    initialOffsetList = initialOffsetList.insert(0, 0, itemHeight)\n  }\n\n  if (defaultItemHeight) {\n    initialOffsetList = initialOffsetList.insert(0, 0, defaultItemHeight)\n  }\n\n  if (initialTopMostItemIndex) {\n    initialOffsetList = initialOffsetList.setInitialIndex(initialTopMostItemIndex)\n  }\n\n  const offsetList$ = subject(initialOffsetList)\n  const { stickyItems$ } = stickyItemsEngine({ offsetList$, scrollTop$, topList$, transposer$ })\n\n  const totalHeight$ = combineLatest(offsetList$, totalCount$, footerHeight$).pipe(\n    map(([offsetList, totalCount, footerHeight]) => offsetList.total(totalCount - 1) + footerHeight)\n  )\n\n  if (!itemHeight) {\n    itemHeights$\n      .pipe(withLatestFrom(offsetList$, stickyItems$, pendingRenderAfterInitial$))\n      .subscribe(([heights, offsetList, stickyItems, pendingRenderAfterInitial]) => {\n        let newList = offsetList\n\n        if (pendingRenderAfterInitial) {\n          newList = OffsetList.create()\n          pendingRenderAfterInitial = false\n        }\n\n        for (const { start, end, size } of heights) {\n          if (newList.empty() && start === end && stickyItems.indexOf(start) > -1) {\n            newList = newList.insertSpots(stickyItems, size)\n          } else {\n            newList = newList.insert(start, end, size)\n          }\n        }\n\n        if (newList !== offsetList) {\n          offsetList$.next(newList)\n          heightsChanged$.next([true, newList])\n        } else {\n          heightsChanged$.next([false, newList])\n        }\n      })\n  }\n\n  return {\n    totalCount$,\n    offsetList$,\n    totalHeight$,\n    footerHeight$,\n    initialItemCount$,\n    itemHeights$,\n    stickyItems$,\n    heightsChanged$,\n  }\n}\n","import { TObservable, subject, combineLatest, map } from '../tinyrx'\n\ninterface ScrolledToBottomParams {\n  scrollTop$: TObservable<number>\n  viewportHeight$: TObservable<number>\n  totalHeight$: TObservable<number>\n}\n\nexport function scrolledToBottomEngine({ totalHeight$, viewportHeight$, scrollTop$ }: ScrolledToBottomParams) {\n  const scrolledToBottom$ = subject(false)\n\n  let notAtBottom: number\n\n  combineLatest(scrollTop$, viewportHeight$, totalHeight$)\n    .pipe(\n      map(([scrollTop, viewportHeight, totalHeight]) => {\n        if (viewportHeight === 0) return false\n        return scrollTop === totalHeight - viewportHeight\n      })\n    )\n    .subscribe(value => {\n      clearTimeout(notAtBottom)\n      if (!value) {\n        notAtBottom = setTimeout(() => scrolledToBottom$.next(false))\n      } else {\n        scrolledToBottom$.next(true)\n      }\n    })\n\n  return {\n    scrolledToBottom$,\n  }\n}\n","import {\n  TObservable,\n  subject,\n  filter,\n  mapTo,\n  throttleTime,\n  scan,\n  map,\n  withLatestFrom,\n  duc,\n  combineLatest,\n} from '../tinyrx'\nimport { ComponentType } from 'react'\n\nexport interface ListRange {\n  startIndex: number\n  endIndex: number\n}\n\nexport interface ScrollSeekToggle {\n  (velocity: number, range: ListRange): boolean\n}\n\nexport type TSeekPlaceholder = ComponentType<{ height: number; index: number }>\n\nexport interface ScrollSeekConfiguration {\n  enter: ScrollSeekToggle\n  change: (velocity: number, range: ListRange) => void\n  exit: ScrollSeekToggle\n  placeholder: TSeekPlaceholder\n}\n\ninterface ScrollSeekParams {\n  isScrolling$: TObservable<boolean>\n  scrollTop$: TObservable<number>\n  rangeChanged$: TObservable<ListRange>\n}\n\nexport function scrollSeekEngine({ isScrolling$, scrollTop$, rangeChanged$: range$ }: ScrollSeekParams) {\n  const scrollVelocity$ = subject(0)\n  const isSeeking$ = subject(false)\n  const scrollSeekConfiguration$ = subject<ScrollSeekConfiguration | undefined | false>(false)\n\n  isScrolling$\n    .pipe(\n      filter(val => !val),\n      mapTo(0)\n    )\n    .subscribe(scrollVelocity$.next)\n\n  scrollTop$\n    .pipe(\n      throttleTime(100),\n      scan(([_, prev], next) => [prev, next], [0, 0]),\n      map(([prev, next]) => next - prev)\n    )\n    .subscribe(scrollVelocity$.next)\n\n  scrollVelocity$\n    .pipe(\n      withLatestFrom(scrollSeekConfiguration$, isSeeking$, range$),\n      filter(([_, config]) => !!config),\n      map(([speed, config, isSeeking, range]: any) => {\n        const { exit, enter } = config!\n        if (isSeeking) {\n          if (exit(speed, range)) {\n            return false\n          }\n        } else {\n          if (enter(speed, range)) {\n            return true\n          }\n        }\n        return isSeeking\n      }),\n      duc()\n    )\n    .subscribe(isSeeking$.next)\n\n  combineLatest(isSeeking$, scrollVelocity$, range$)\n    .pipe(withLatestFrom(scrollSeekConfiguration$))\n    .subscribe(([[isSeeking, velocity, range], config]) => isSeeking && config && config!.change(velocity, range))\n\n  return { isSeeking$, scrollSeekConfiguration$, scrollVelocity$ }\n}\n","import { subject, TObservable, TSubject, withLatestFrom } from '../tinyrx'\nimport { TScrollLocation } from '../EngineCommons'\nimport { OffsetList } from '../OffsetList'\n\nexport interface InitialTopMostItemIndexParams {\n  initialTopMostItemIndex: number | undefined\n  scrollTop$: TObservable<number>\n  scrollTo$: TSubject<ScrollToOptions>\n  scrollToIndex$: TSubject<TScrollLocation>\n  offsetList$: TObservable<OffsetList>\n}\n\nexport function initialTopMostItemIndexEngine({\n  initialTopMostItemIndex,\n  scrollToIndex$,\n  scrollTop$,\n  scrollTo$,\n  offsetList$,\n}: InitialTopMostItemIndexParams) {\n  const scrolledToTopMostItem$ = subject(!initialTopMostItemIndex)\n\n  scrollTop$\n    .pipe(withLatestFrom(scrollTo$, scrolledToTopMostItem$))\n    .subscribe(([scrollTop, scrollTo, scrolledToTopMostItem]) => {\n      if (scrollTop === scrollTo.top && !scrolledToTopMostItem) {\n        // skip a tick, so that the list$ can grab the scrollTop$ update\n        setTimeout(() => {\n          scrolledToTopMostItem$.next(true)\n        })\n      }\n    })\n\n  offsetList$.pipe(withLatestFrom(scrolledToTopMostItem$)).subscribe(([_, scrolledToTopMostItem]) => {\n    if (!scrolledToTopMostItem) {\n      // hack: wait for the viewport to get populated :(\n      setTimeout(() => {\n        scrollToIndex$.next(initialTopMostItemIndex!)\n      })\n    }\n  })\n\n  return {\n    scrolledToTopMostItem$,\n  }\n}\n","import { TScrollLocation } from '../EngineCommons'\nimport { OffsetList } from '../OffsetList'\nimport { coldSubject, map, subject, TObservable, TSubject, withLatestFrom } from '../tinyrx'\nimport { initialTopMostItemIndexEngine } from './initialTopMostItemEngine'\n\nexport interface ScrollToIndexParams {\n  heightsChanged$: TSubject<[boolean, OffsetList]>\n  offsetList$: TSubject<OffsetList>\n  topListHeight$: TObservable<number>\n  stickyItems$: TObservable<number[]>\n  viewportHeight$: TSubject<number>\n  totalCount$: TObservable<number>\n  totalHeight$: TObservable<number>\n  scrollTop$: TObservable<number>\n  initialTopMostItemIndex: number | undefined\n}\n\nexport function scrollToIndexEngine({\n  offsetList$,\n  topListHeight$,\n  stickyItems$,\n  viewportHeight$,\n  totalCount$,\n  totalHeight$,\n  initialTopMostItemIndex,\n  heightsChanged$,\n  scrollTop$,\n}: ScrollToIndexParams) {\n  const scrollToIndex$ = coldSubject<TScrollLocation>()\n  const scrollToIndexRequestPending$ = subject(false)\n  const scrollTopReportedAfterScrollToIndex$ = subject(true)\n  const scrollTo$ = coldSubject<ScrollToOptions>()\n\n  const { scrolledToTopMostItem$ } = initialTopMostItemIndexEngine({\n    scrollTo$,\n    offsetList$,\n    scrollToIndex$,\n    scrollTop$,\n    initialTopMostItemIndex,\n  })\n\n  heightsChanged$.pipe(withLatestFrom(scrolledToTopMostItem$)).subscribe(([[changed], scrolledToTopMostItem]) => {\n    if (!changed && scrolledToTopMostItem) {\n      scrollToIndexRequestPending$.next(false)\n      scrollTopReportedAfterScrollToIndex$.next(true)\n    }\n  })\n\n  scrollToIndex$\n    .pipe(\n      withLatestFrom(offsetList$, topListHeight$, stickyItems$, viewportHeight$, totalCount$, totalHeight$),\n      map(([location, offsetList, topListHeight, stickyItems, viewportHeight, totalCount, totalHeight]) => {\n        if (typeof location === 'number') {\n          location = { index: location, align: 'start', behavior: 'auto' }\n        }\n        let { index, align = 'start' } = location\n\n        index = Math.max(0, index, Math.min(totalCount - 1, index))\n\n        let offset = offsetList.offsetOf(index)\n        if (align === 'end') {\n          offset = offset - viewportHeight + offsetList.itemAt(index).size\n        } else if (align === 'center') {\n          offset = Math.round(offset - viewportHeight / 2 + offsetList.itemAt(index).size / 2)\n        } else {\n          if (stickyItems.indexOf(index) === -1) {\n            offset -= topListHeight\n          }\n        }\n\n        scrollTopReportedAfterScrollToIndex$.next(false)\n        return {\n          top: Math.max(0, Math.min(offset, Math.floor(totalHeight - viewportHeight))),\n          behavior: location.behavior ?? 'auto',\n        }\n      })\n    )\n    .subscribe(scrollTo$.next)\n\n  scrollTop$.pipe(withLatestFrom(scrollTopReportedAfterScrollToIndex$)).subscribe(([_, scrollTopReported]) => {\n    if (!scrollTopReported) {\n      scrollTopReportedAfterScrollToIndex$.next(true)\n      scrollToIndexRequestPending$.next(true)\n    }\n  })\n\n  // if the list has received new heights, the scrollTo call calculations were wrong;\n  // we will retry by re-requesting the same index\n  offsetList$\n    .pipe(withLatestFrom(scrollToIndexRequestPending$, scrollToIndex$))\n    .subscribe(([_, scrollToIndexRequestPending, scrollToIndex]) => {\n      if (scrollToIndexRequestPending) {\n        scrollToIndex$.next(scrollToIndex)\n      }\n    })\n\n  return {\n    scrollToIndex$,\n    scrollTo$,\n    scrolledToTopMostItem$,\n  }\n}\n","import { TObservable, subject, combineLatest, filter, withLatestFrom, map, TSubject } from '../tinyrx'\nimport { OffsetList } from '../OffsetList'\nimport { Transposer, ListItem } from '../GroupIndexTransposer'\n\ninterface TopItemCountParams {\n  offsetList$: TObservable<OffsetList>\n  totalCount$: TObservable<number>\n  topList$: TSubject<ListItem[]>\n  viewportHeight$: TObservable<number>\n  transposer$: TObservable<Transposer>\n}\nexport function topItemCountEngine({\n  topList$,\n  transposer$,\n  viewportHeight$,\n  totalCount$,\n  offsetList$,\n}: TopItemCountParams) {\n  const topItemCount$ = subject<number>()\n\n  combineLatest(offsetList$, topItemCount$, totalCount$, viewportHeight$)\n    .pipe(\n      filter(params => params[1] > 0 && params[3] > 0),\n      withLatestFrom(transposer$),\n      map(([[offsetList, topItemCount, totalCount], transposer]) => {\n        const endIndex = Math.max(0, Math.min(topItemCount - 1, totalCount))\n        return transposer.transpose(offsetList.indexRange(0, endIndex))\n      })\n    )\n    .subscribe(topList$.next)\n  return { topItemCount$ }\n}\n","import { subject, map } from '../tinyrx'\nimport { ListItem } from '../GroupIndexTransposer'\n\nexport function topListEngine() {\n  const topList$ = subject<ListItem[]>([])\n\n  const topListHeight$ = topList$.pipe(map(items => items.reduce((total, item) => total + item.size, 0)))\n\n  const minListIndex$ = topList$.pipe(\n    map(topList => {\n      return topList.length && topList[topList.length - 1].index + 1\n    })\n  )\n\n  return {\n    topList$,\n    topListHeight$,\n    minListIndex$,\n  }\n}\n","import { TObservable, TSubscription } from './tinyrx'\n\nexport interface TOutput<T> {\n  (callback: TCallback<T> | undefined): void\n}\n\nexport interface TInput<T> {\n  (val: T): void\n}\n\ntype TCallback<T> = (val: T) => void\n\nexport function makeOutput<T>(observable: TObservable<T>): TOutput<T> {\n  let unsubscribe: TSubscription | undefined\n\n  return (callback: TCallback<T> | undefined) => {\n    if (unsubscribe) {\n      unsubscribe()\n    }\n    if (callback) {\n      unsubscribe = observable.subscribe(callback)\n    }\n  }\n}\n\nexport function makeInput<T>(subject: { next: (value: T) => void }): TInput<T> {\n  return subject.next\n}\n","import React, { ReactElement } from 'react'\nimport { coldSubject, combineLatest, duc, filter, map, subject, withLatestFrom } from '../src/tinyrx'\nimport { buildIsScrolling } from './EngineCommons'\nimport { adjustForPrependedItemsEngine } from './engines/adjustForPrependedItemsEngine'\nimport { followOutputEngine } from './engines/followOutputEngine'\nimport { groupCountEngine } from './engines/groupCountEgine'\nimport { listEngine } from './engines/listEngine'\nimport { maxRangeSizeEngine } from './engines/maxRangeSizeEngine'\nimport { offsetListEngine } from './engines/offsetListEngine'\nimport { scrolledToBottomEngine } from './engines/scrolledToBottomEngine'\nimport { ListRange, scrollSeekEngine } from './engines/scrollSeekEngine'\nimport { scrollToIndexEngine } from './engines/scrollToIndexEngine'\nimport { topItemCountEngine } from './engines/topItemCountEngine'\nimport { topListEngine } from './engines/topListEngine'\nimport { ListItem, StubIndexTransposer, Transposer } from './GroupIndexTransposer'\nimport { makeInput, makeOutput } from './rxio'\n\nexport interface ItemHeight {\n  start: number\n  end: number\n  size: number\n}\n\ninterface TVirtuosoConstructorParams {\n  overscan?: number\n  totalCount?: number\n  topItems?: number\n  itemHeight?: number\n  defaultItemHeight?: number\n  initialTopMostItemIndex?: number\n}\n\nconst VirtuosoStore = ({\n  overscan = 0,\n  totalCount = 0,\n  itemHeight,\n  initialTopMostItemIndex,\n  defaultItemHeight,\n}: TVirtuosoConstructorParams) => {\n  const transposer$ = subject<Transposer>(new StubIndexTransposer())\n  const viewportHeight$ = subject(0)\n  const scrollTop$ = subject(0, false)\n  const isScrolling$ = buildIsScrolling(scrollTop$)\n\n  const { topList$, minListIndex$, topListHeight$ } = topListEngine()\n  const {\n    stickyItems$,\n    initialItemCount$,\n    itemHeights$,\n    offsetList$,\n    totalCount$,\n    footerHeight$,\n    totalHeight$,\n    heightsChanged$,\n  } = offsetListEngine({\n    totalCount,\n    itemHeight,\n    defaultItemHeight,\n    initialTopMostItemIndex,\n    viewportHeight$,\n    scrollTop$,\n    transposer$,\n    topList$,\n  })\n\n  const { groupCounts$, groupIndices$ } = groupCountEngine({ totalCount$, transposer$, stickyItems$ })\n\n  const { scrolledToBottom$ } = scrolledToBottomEngine({ totalHeight$, viewportHeight$, scrollTop$ })\n\n  const { scrolledToTopMostItem$, scrollToIndex$, scrollTo$ } = scrollToIndexEngine({\n    initialTopMostItemIndex,\n    scrollTop$,\n    offsetList$,\n    viewportHeight$,\n    totalHeight$,\n    stickyItems$,\n    totalCount$,\n    topListHeight$,\n    heightsChanged$,\n  })\n\n  const { listHeight$, list$, listOffset$, endReached$ } = listEngine({\n    overscan,\n    viewportHeight$,\n    scrollTop$,\n    totalHeight$,\n    topListHeight$,\n    footerHeight$,\n    minListIndex$,\n    totalCount$,\n    offsetList$,\n    scrolledToTopMostItem$,\n    transposer$,\n  })\n\n  const { adjustForPrependedItems$, adjustmentInProgress$ } = adjustForPrependedItemsEngine({\n    offsetList$,\n    scrollTop$,\n    scrollTo$,\n  })\n\n  const { maxRangeSize$ } = maxRangeSizeEngine({ scrollTo$, offsetList$, scrollTop$, list$ })\n\n  const { topItemCount$ } = topItemCountEngine({ offsetList$, totalCount$, transposer$, viewportHeight$, topList$ })\n\n  const { followOutput$ } = followOutputEngine({ totalCount$, scrollToIndex$, scrolledToBottom$ })\n\n  const stickyItemsOffset$ = listOffset$.pipe(map(offset => -offset))\n\n  const rangeChanged$ = coldSubject<ListRange>()\n\n  list$\n    .pipe(\n      withLatestFrom(adjustmentInProgress$),\n      filter<[ListItem[], boolean]>(([list, inProgress]) => list.length !== 0 && !inProgress),\n      map(([list]) => {\n        const { index: startIndex } = list[0]\n        const { index: endIndex } = list[list.length - 1]\n        return { startIndex, endIndex }\n      }),\n      duc((current, next) => !current || current.startIndex !== next.startIndex || current.endIndex !== next.endIndex)\n    )\n    .subscribe(rangeChanged$.next)\n\n  const { isSeeking$, scrollVelocity$, scrollSeekConfiguration$ } = scrollSeekEngine({\n    scrollTop$,\n    isScrolling$,\n    rangeChanged$,\n  })\n\n  const MAX_OFFSET_HEIGHT = 15000000\n  const domTotalHeight$ = totalHeight$.pipe(map(value => Math.min(value, MAX_OFFSET_HEIGHT)))\n\n  const scrollTopMultiplier$ = combineLatest(totalHeight$, domTotalHeight$, viewportHeight$).pipe(\n    map(([totalHeight, domTotalHeight, viewportHeight]) => {\n      if (totalHeight === domTotalHeight) {\n        return 1\n      }\n      return (totalHeight - viewportHeight) / (domTotalHeight - viewportHeight)\n    })\n  )\n\n  const domScrollTop$ = subject(0, false)\n\n  const domListOffset$ = combineLatest(listOffset$, scrollTopMultiplier$).pipe(\n    map(([offset, multiplier]) => offset / multiplier)\n  )\n\n  combineLatest(domScrollTop$, scrollTopMultiplier$)\n    .pipe(map(([domScrollTop, multiplier]) => domScrollTop * multiplier))\n    .subscribe(scrollTop$.next)\n\n  const computeItemKey$ = subject((itemIndex: number) => itemIndex as React.Key)\n  const renderProp$ = subject((index: number, _groupIndex?: number) => index as any)\n  const groupRenderProp$ = subject((index: number) => index as any)\n  const itemContainer$ = subject<React.ComponentType<any> | string>('div')\n  const groupContainer$ = subject<React.ComponentType<any> | string>('div')\n  const itemRender$ = subject<any>(false)\n  const dataKey$ = subject<string | symbol | undefined>(Symbol('data-key'))\n\n  combineLatest(\n    renderProp$,\n    groupRenderProp$,\n    scrollSeekConfiguration$,\n    computeItemKey$,\n    itemContainer$,\n    groupContainer$,\n    dataKey$\n  )\n    .pipe(\n      map(([render, groupRender, scrollSeek, computeItemKey, ItemContainer, GroupContainer, _dataKey]) => {\n        return {\n          render: (item: any, { key, renderPlaceholder, ...itemProps }: any) => {\n            if (computeItemKey) {\n              key = computeItemKey(item.index)\n            }\n\n            if (item.type === 'group') {\n              return React.createElement(GroupContainer, { key, ...itemProps }, groupRender(item.groupIndex))\n            } else {\n              let children: ReactElement\n              if (scrollSeek && renderPlaceholder) {\n                children = React.createElement(scrollSeek.placeholder, {\n                  height: itemProps['data-known-size'],\n                  index: item.index,\n                })\n              } else {\n                children = render(item.transposedIndex)\n              }\n\n              return React.createElement(ItemContainer, { ...itemProps, key }, children)\n            }\n          },\n        }\n      })\n    )\n    .subscribe(itemRender$.next)\n\n  return {\n    groupCounts: makeInput(groupCounts$),\n    itemHeights: makeInput(itemHeights$),\n    footerHeight: makeInput(footerHeight$),\n    listHeight: makeInput(listHeight$),\n    viewportHeight: makeInput(viewportHeight$),\n    scrollTop: makeInput(domScrollTop$),\n    topItemCount: makeInput(topItemCount$),\n    totalCount: makeInput(totalCount$),\n    scrollToIndex: makeInput(scrollToIndex$),\n    initialItemCount: makeInput(initialItemCount$),\n    followOutput: makeInput(followOutput$),\n    adjustForPrependedItems: makeInput(adjustForPrependedItems$),\n    maxRangeSize: makeInput(maxRangeSize$),\n    scrollSeekConfiguration: makeInput(scrollSeekConfiguration$),\n\n    renderProp: makeInput(renderProp$),\n    groupRenderProp: makeInput(groupRenderProp$),\n    computeItemKey: makeInput(computeItemKey$),\n    itemContainer: makeInput(itemContainer$),\n    groupContainer: makeInput(groupContainer$),\n    dataKey: makeInput(dataKey$),\n\n    itemRender: makeOutput(itemRender$),\n\n    list: makeOutput(list$),\n    isSeeking: makeOutput(isSeeking$),\n    scrollVelocity: makeOutput(scrollVelocity$),\n    itemsRendered: makeOutput(list$),\n    topList: makeOutput(topList$),\n    listOffset: makeOutput(domListOffset$),\n    totalHeight: makeOutput(domTotalHeight$),\n    endReached: makeOutput(endReached$),\n    atBottomStateChange: makeOutput(scrolledToBottom$),\n    totalListHeightChanged: makeOutput(totalHeight$),\n    rangeChanged: makeOutput(rangeChanged$),\n    isScrolling: makeOutput(isScrolling$),\n    stickyItems: makeOutput(stickyItems$),\n    groupIndices: makeOutput(groupIndices$),\n    stickyItemsOffset: makeOutput(stickyItemsOffset$),\n    scrollTo: makeOutput(scrollTo$),\n  }\n}\n\nexport { VirtuosoStore }\n","import { CSSProperties } from 'react'\n\nexport const viewportStyle: CSSProperties = {\n  top: 0,\n  position: 'absolute',\n  height: '100%',\n  width: '100%',\n}\n","import { useEffect, useRef, useState } from 'react'\nimport ResizeObserver from 'resize-observer-polyfill'\nimport { TInput, TOutput } from './rxio'\n\nexport type CallbackRefParam = HTMLElement | null\nexport type CallbackRef = (ref: CallbackRefParam) => void\n\ntype UseHeight = (\n  input: TInput<number>,\n  onMount?: (ref: CallbackRefParam) => void,\n  onResize?: (ref: HTMLElement) => void\n) => CallbackRef\n\nexport const useHeight: UseHeight = (input, onMount, onResize) => {\n  const ref = useRef<CallbackRefParam>(null)\n  const animationFrameID = useRef<number>(0)\n  const observer = new ResizeObserver(entries => {\n    const newHeight = Math.round(entries[0].contentRect.height)\n    if (onResize) {\n      animationFrameID.current = window.requestAnimationFrame(() => {\n        const element = entries[0].target as HTMLElement\n        if (document.body.contains(element)) {\n          onResize(element)\n        }\n      })\n    }\n    input(newHeight)\n  })\n\n  const callbackRef = (elRef: CallbackRefParam) => {\n    if (elRef) {\n      observer.observe(elRef)\n      if (onMount) {\n        onMount(elRef)\n      }\n      ref.current = elRef\n    } else {\n      observer.unobserve(ref.current!)\n      ref.current = null\n    }\n  }\n\n  useEffect(() => () => window.cancelAnimationFrame(animationFrameID.current), [])\n  return callbackRef\n}\n\nfunction callbackToValue<T>(output: (callback: (val: T) => void) => void, defaultValue: T) {\n  return () => {\n    let result = defaultValue\n    output(val => {\n      result = val\n    })\n    return result\n  }\n}\n\nexport function useOutput<T>(output: TOutput<T>, initialValue: T): T {\n  const [value, setValue] = useState(callbackToValue<T>(output, initialValue))\n\n  useEffect(() => {\n    output(setValue)\n    return () => output(undefined)\n  }, [output])\n  return value\n}\n\ntype UseSize = (callback: (params: { element: HTMLElement; width: number; height: number }) => void) => CallbackRef\n\nexport const useSize: UseSize = callback => {\n  const ref = useRef<CallbackRefParam>(null)\n  const currentSize = useRef([0, 0])\n\n  const observer = new ResizeObserver(entries => {\n    const { width, height } = entries[0].contentRect\n    if (currentSize.current[0] !== width || currentSize.current[1] !== height) {\n      currentSize.current = [width, height]\n      callback({\n        element: entries[0].target as HTMLElement,\n        width: Math.round(width),\n        height: Math.round(height),\n      })\n    }\n  })\n\n  const callbackRef = (elRef: CallbackRefParam) => {\n    if (elRef) {\n      observer.observe(elRef)\n      ref.current = elRef\n    } else {\n      observer.unobserve(ref.current!)\n      ref.current = null\n    }\n  }\n\n  return callbackRef\n}\n\nexport function simpleMemoize<T extends () => any>(func: T): T {\n  let called = false\n  let result: any\n\n  return (() => {\n    if (!called) {\n      called = true\n      result = func()\n    }\n    return result\n  }) as T\n}\n\nconst WEBKIT_STICKY = '-webkit-sticky'\nconst STICKY = 'sticky'\n\nexport const positionStickyCssValue = simpleMemoize(() => {\n  const node = document.createElement('div')\n  node.style.position = WEBKIT_STICKY\n  return node.style.position === WEBKIT_STICKY ? WEBKIT_STICKY : STICKY\n})\n","import React, { FC } from 'react'\n\nexport const VirtuosoFiller: FC<{ height: number }> = ({ height }) => (\n  <div style={{ height: `${height}px`, position: 'absolute', top: 0 }}>&nbsp;</div>\n)\n","import React, { useContext, ReactElement, CSSProperties, ReactNode } from 'react'\nimport { useOutput, positionStickyCssValue } from './Utils'\nimport { VirtuosoContext } from './VirtuosoContext'\nimport { ListItem } from './GroupIndexTransposer'\n\nexport interface TRenderProps {\n  key: React.Key\n  'data-index': number\n  'data-known-size': number\n  renderPlaceholder: boolean\n  style?: CSSProperties\n}\nexport type TRender = (item: ListItem, props: TRenderProps) => ReactElement\n\nexport const VirtuosoList: React.FC<{}> = React.memo(() => {\n  const { isSeeking, topList, list, itemRender } = useContext(VirtuosoContext)!\n  const items = useOutput<ListItem[]>(list, [])\n  const topItems = useOutput<ListItem[]>(topList, [])\n  const render = useOutput(itemRender, false as any)\n  const renderPlaceholder = useOutput(isSeeking, false)\n\n  const renderedItems: ReactNode[] = []\n  let topOffset = 0\n  const renderedTopItemIndices: number[] = []\n\n  const marginTop = topItems.reduce((acc, item) => {\n    return acc + item.size\n  }, 0)\n\n  topItems.forEach((item, index) => {\n    const itemIndex = item.index\n    renderedTopItemIndices.push(itemIndex)\n\n    const style: CSSProperties = {\n      top: `${topOffset}px`,\n      marginTop: index === 0 ? `${-marginTop}px` : undefined,\n      zIndex: 2,\n      position: positionStickyCssValue(),\n    }\n\n    const props = {\n      key: itemIndex,\n      'data-index': itemIndex,\n      'data-known-size': item.size,\n      renderPlaceholder,\n      style,\n    }\n\n    render && renderedItems.push(render.render(item, props))\n    topOffset += item.size\n  })\n\n  items.forEach(item => {\n    if (renderedTopItemIndices.indexOf(item.index) > -1) {\n      return\n    }\n\n    render &&\n      renderedItems.push(\n        render.render(item, {\n          key: item.index,\n          'data-index': item.index,\n          'data-known-size': item.size,\n          renderPlaceholder,\n        })\n      )\n  })\n\n  return <>{renderedItems}</>\n})\n","import React, { FC, CSSProperties, useCallback, useRef } from 'react'\n\nconst scrollerStyle: React.CSSProperties = {\n  height: '40rem',\n  overflowY: 'auto',\n  WebkitOverflowScrolling: 'touch',\n  position: 'relative',\n  outline: 'none',\n}\n\nexport type TScrollContainer = FC<{\n  style: CSSProperties\n  className?: string\n  reportScrollTop: (scrollTop: number) => void\n  scrollTo: (callback: (scrollTop: ScrollToOptions) => void) => void\n}>\n\nconst DefaultScrollContainer: TScrollContainer = ({ className, style, reportScrollTop, scrollTo, children }) => {\n  const elRef = useRef<HTMLElement | null>(null)\n  const smoothScrollTarget = useRef<number | null>(null)\n  const currentScrollTop = useRef<number | null>()\n\n  const onScroll: EventListener = useCallback(\n    (e: Event) => {\n      const scrollTop = (e.target as HTMLDivElement).scrollTop\n      currentScrollTop.current = scrollTop\n      if (smoothScrollTarget.current !== null) {\n        if (smoothScrollTarget.current === scrollTop) {\n          // console.log('reporting smooth scrolling')\n          smoothScrollTarget.current = null\n          reportScrollTop(scrollTop)\n        } else {\n          // console.log('skip reporting')\n        }\n      } else {\n        reportScrollTop(scrollTop)\n      }\n    },\n    [reportScrollTop]\n  )\n\n  const ref = useCallback(\n    (theRef: HTMLElement | null) => {\n      if (theRef) {\n        theRef.addEventListener('scroll', onScroll, { passive: true })\n        elRef.current = theRef\n      } else {\n        if (elRef.current) {\n          elRef.current.removeEventListener('scroll', onScroll)\n        }\n      }\n    },\n    [onScroll]\n  )\n\n  scrollTo(location => {\n    if (currentScrollTop.current !== location.top) {\n      if (location.behavior === 'smooth') {\n        smoothScrollTarget.current = location.top!\n      }\n      elRef.current && elRef.current!.scrollTo(location)\n    }\n  })\n\n  return (\n    <div ref={ref} style={style} tabIndex={0} className={className}>\n      {children}\n    </div>\n  )\n}\n\nexport const VirtuosoScroller: FC<{\n  className?: string\n  style: CSSProperties\n  ScrollContainer?: TScrollContainer\n  scrollTop: (scrollTop: number) => void\n  scrollTo: (callback: (scrollTop: ScrollToOptions) => void) => void\n}> = ({ children, style, className, ScrollContainer = DefaultScrollContainer, scrollTop, scrollTo }) => {\n  return (\n    <ScrollContainer\n      style={{ ...scrollerStyle, ...style }}\n      reportScrollTop={scrollTop}\n      scrollTo={scrollTo}\n      className={className}\n    >\n      {children}\n    </ScrollContainer>\n  )\n}\n","import React, { CSSProperties, FC, ReactElement, useContext } from 'react'\nimport { ItemHeight } from 'VirtuosoStore'\nimport { viewportStyle } from './Style'\nimport { CallbackRef, useHeight, useOutput } from './Utils'\nimport { VirtuosoContext } from './VirtuosoContext'\nimport { VirtuosoFiller } from './VirtuosoFiller'\nimport { VirtuosoList } from './VirtuosoList'\nimport { TScrollContainer, VirtuosoScroller } from './VirtuosoScroller'\n\nexport const DefaultFooterContainer: React.FC<{ footerRef: CallbackRef }> = ({ children, footerRef }) => (\n  <footer ref={footerRef}>{children}</footer>\n)\n\nexport const DefaultListContainer: React.FC<{ listRef: CallbackRef; style: CSSProperties }> = ({\n  children,\n  listRef,\n  style,\n}) => {\n  return (\n    <div ref={listRef} style={style}>\n      {children}\n    </div>\n  )\n}\n\nexport type TListContainer = typeof DefaultListContainer\nexport type TFooterContainer = typeof DefaultFooterContainer\n\nexport { TScrollContainer }\n\nconst VirtuosoFooter: FC<{ footer: () => ReactElement; FooterContainer?: TFooterContainer }> = ({\n  footer,\n  FooterContainer = DefaultFooterContainer,\n}) => {\n  const footerCallbackRef = useHeight(useContext(VirtuosoContext)!.footerHeight)\n  return <FooterContainer footerRef={footerCallbackRef}>{footer()}</FooterContainer>\n}\n\nconst getHeights = (children: HTMLCollection) => {\n  const results: ItemHeight[] = []\n  for (let i = 0, len = children.length; i < len; i++) {\n    const child = children.item(i) as HTMLElement\n\n    if (!child || child.dataset.index === undefined) {\n      continue\n    }\n\n    const index = parseInt(child.dataset.index!)\n    const knownSize = parseInt(child.dataset.knownSize!)\n    const size = child.offsetHeight\n\n    if (size === knownSize) {\n      continue\n    }\n\n    const lastResult = results[results.length - 1]\n    if (results.length === 0 || lastResult.size !== size || lastResult.end !== index - 1) {\n      results.push({ start: index, end: index, size })\n    } else {\n      results[results.length - 1].end++\n    }\n  }\n\n  return results\n}\n\nconst ListWrapper: React.FC<{ fixedItemHeight: boolean; ListContainer: TListContainer }> = ({\n  fixedItemHeight,\n  children,\n  ListContainer,\n}) => {\n  const { listHeight, itemHeights, listOffset } = useContext(VirtuosoContext)!\n  const translate = useOutput<number>(listOffset, 0)\n  const style = { marginTop: `${translate}px` }\n\n  const listCallbackRef = useHeight(\n    listHeight,\n    () => {},\n    ref => {\n      if (!fixedItemHeight) {\n        const measuredItemHeights = getHeights(ref!.children)\n        itemHeights(measuredItemHeights)\n      }\n    }\n  )\n\n  return (\n    <ListContainer listRef={listCallbackRef} style={style}>\n      {children}\n    </ListContainer>\n  )\n}\n\nexport const VirtuosoView: React.FC<{\n  style: CSSProperties\n  className?: string\n  footer?: () => ReactElement\n  ScrollContainer?: TScrollContainer\n  ListContainer: TListContainer\n  FooterContainer?: TFooterContainer\n  fixedItemHeight: boolean\n}> = ({ style, footer, fixedItemHeight, ScrollContainer, ListContainer, FooterContainer, className }) => {\n  const { scrollTo, scrollTop, totalHeight, viewportHeight } = useContext(VirtuosoContext)!\n  const fillerHeight = useOutput<number>(totalHeight, 0)\n  const reportScrollTop = (st: number) => {\n    scrollTop(Math.max(st, 0))\n  }\n\n  const viewportCallbackRef = useHeight(viewportHeight)\n\n  return (\n    <VirtuosoScroller\n      style={style}\n      ScrollContainer={ScrollContainer}\n      className={className}\n      scrollTo={scrollTo}\n      scrollTop={reportScrollTop}\n    >\n      <div ref={viewportCallbackRef} style={viewportStyle}>\n        <ListWrapper fixedItemHeight={fixedItemHeight} ListContainer={ListContainer}>\n          <VirtuosoList />\n          {footer && <VirtuosoFooter footer={footer} FooterContainer={FooterContainer} />}\n        </ListWrapper>\n      </div>\n\n      <VirtuosoFiller height={fillerHeight} />\n    </VirtuosoScroller>\n  )\n}\n","import React, { CSSProperties, FC, forwardRef, ReactElement, useImperativeHandle, useEffect, useState } from 'react'\nimport { TScrollLocation } from './EngineCommons'\nimport { ListRange, ScrollSeekConfiguration } from './engines/scrollSeekEngine'\nimport { ListItem } from './GroupIndexTransposer'\nimport { TSubscriber } from './tinyrx'\nimport { VirtuosoContext } from './VirtuosoContext'\nimport { TRenderProps } from './VirtuosoList'\nimport { VirtuosoStore } from './VirtuosoStore'\nimport { DefaultListContainer, TFooterContainer, TListContainer, TScrollContainer, VirtuosoView } from './VirtuosoView'\n\nexport type VirtuosoState = ReturnType<typeof VirtuosoStore>\n\nexport type TItemContainer = React.FC<Omit<TRenderProps, 'renderPlaceholder' | 'scrollVelocity'>>\n\nexport interface VirtuosoProps {\n  totalCount: number\n  overscan?: number\n  topItems?: number\n  footer?: () => ReactElement\n  item: (index: number) => ReactElement\n  computeItemKey?: (index: number) => React.Key\n  prependItemCount?: number\n  itemHeight?: number\n  defaultItemHeight?: number\n  endReached?: (index: number) => void\n  scrollingStateChange?: TSubscriber<boolean>\n  atBottomStateChange?: TSubscriber<boolean>\n  itemsRendered?: TSubscriber<ListItem[]>\n  rangeChanged?: TSubscriber<ListRange>\n  totalListHeightChanged?: TSubscriber<number>\n  style?: CSSProperties\n  dataKey?: string\n  className?: string\n  initialItemCount?: number\n  initialTopMostItemIndex?: number\n  followOutput?: boolean\n  ScrollContainer?: TScrollContainer\n  FooterContainer?: TFooterContainer\n  ListContainer?: TListContainer\n  ItemContainer?: TItemContainer\n  maxHeightCacheSize?: number\n  scrollSeek?: ScrollSeekConfiguration\n}\n\nexport interface TVirtuosoPresentationProps {\n  contextValue: VirtuosoState\n  footer?: () => ReactElement\n  style?: CSSProperties\n  className?: string\n  itemHeight?: number\n  ScrollContainer?: TScrollContainer\n  FooterContainer?: TFooterContainer\n  ListContainer?: TListContainer\n}\n\nexport { TScrollContainer, TListContainer }\n\nconst DEFAULT_STYLE = {}\nexport const VirtuosoPresentation: FC<TVirtuosoPresentationProps> = React.memo(\n  ({ contextValue, style, className, footer, itemHeight, ScrollContainer, ListContainer, FooterContainer }) => {\n    return (\n      <VirtuosoContext.Provider value={contextValue}>\n        <VirtuosoView\n          style={style || DEFAULT_STYLE}\n          className={className}\n          footer={footer}\n          fixedItemHeight={itemHeight !== undefined}\n          ScrollContainer={ScrollContainer}\n          FooterContainer={FooterContainer}\n          ListContainer={ListContainer || DefaultListContainer}\n        />\n      </VirtuosoContext.Provider>\n    )\n  }\n)\n\nexport interface VirtuosoMethods {\n  scrollToIndex(location: TScrollLocation): void\n  adjustForPrependedItems(count: number): void\n}\n\nexport const Virtuoso = forwardRef<VirtuosoMethods, VirtuosoProps>((props, ref) => {\n  const [state] = useState(() => VirtuosoStore(props))\n  useImperativeHandle(\n    ref,\n    () => ({\n      scrollToIndex: (location: TScrollLocation) => {\n        state.scrollToIndex(location)\n      },\n\n      adjustForPrependedItems: (count: number) => {\n        state.adjustForPrependedItems(count)\n      },\n    }),\n    [state]\n  )\n\n  useEffect(() => {\n    state.isScrolling(props.scrollingStateChange)\n    state.atBottomStateChange(props.atBottomStateChange)\n    state.endReached(props.endReached)\n    state.topItemCount(props.topItems || 0)\n    state.totalCount(props.totalCount)\n    props.initialItemCount && state.initialItemCount(props.initialItemCount)\n    state.itemsRendered(props.itemsRendered)\n    state.totalListHeightChanged(props.totalListHeightChanged)\n    state.followOutput(!!props.followOutput)\n    state.maxRangeSize(props.maxHeightCacheSize || Infinity)\n    state.rangeChanged(props.rangeChanged)\n    state.scrollSeekConfiguration(props.scrollSeek)\n    state.computeItemKey(props.computeItemKey || (key => key))\n    state.itemContainer(props.ItemContainer || 'div')\n    state.renderProp(props.item)\n    state.dataKey(props.dataKey)\n\n    return () => {\n      state.itemsRendered(undefined)\n      state.totalListHeightChanged(undefined)\n    }\n  }, [\n    state,\n    props.scrollingStateChange,\n    props.atBottomStateChange,\n    props.endReached,\n    props.topItems,\n    props.totalCount,\n    props.initialItemCount,\n    props.itemsRendered,\n    props.totalListHeightChanged,\n    props.followOutput,\n    props.maxHeightCacheSize,\n    props.rangeChanged,\n    props.scrollSeek,\n    props.item,\n    props.ItemContainer,\n    props.computeItemKey,\n    props.dataKey,\n  ])\n\n  return (\n    <VirtuosoPresentation\n      contextValue={state}\n      style={props.style}\n      className={props.className}\n      footer={props.footer}\n      itemHeight={props.itemHeight}\n      ScrollContainer={props.ScrollContainer}\n      FooterContainer={props.FooterContainer}\n      ListContainer={props.ListContainer}\n    />\n  )\n})\n\nVirtuoso.displayName = 'Virtuoso'\n","import React, { forwardRef, ReactElement, useImperativeHandle, useState, useEffect } from 'react'\nimport { TScrollLocation } from './EngineCommons'\nimport { TItemContainer, VirtuosoPresentation, VirtuosoProps } from './Virtuoso'\nimport { VirtuosoStore } from './VirtuosoStore'\n\ntype GroupedVirtuosoProps = Pick<VirtuosoProps, Exclude<keyof VirtuosoProps, 'totalCount' | 'topItems' | 'item'>> & {\n  groupCounts: number[]\n  group: (groupIndex: number) => ReactElement\n  item: (index: number, groupIndex?: number) => ReactElement\n  groupIndices?: (indices: number[]) => void\n  GroupContainer?: TItemContainer\n}\n\nexport interface GroupedVirtuosoMethods {\n  scrollToIndex(location: TScrollLocation): void\n}\n\nexport const GroupedVirtuoso = forwardRef<GroupedVirtuosoMethods, GroupedVirtuosoProps>((props, ref) => {\n  const [state] = useState(VirtuosoStore(props))\n  useImperativeHandle(\n    ref,\n    () => ({\n      scrollToIndex: (location: TScrollLocation) => {\n        state.scrollToIndex(location)\n      },\n    }),\n    [state]\n  )\n\n  useEffect(() => {\n    state.endReached(props.endReached)\n    state.rangeChanged(props.rangeChanged)\n    state.atBottomStateChange(props.atBottomStateChange)\n    state.isScrolling(props.scrollingStateChange)\n    state.groupCounts(props.groupCounts)\n    state.groupIndices(props.groupIndices)\n    state.itemsRendered(props.itemsRendered)\n    state.totalListHeightChanged(props.totalListHeightChanged)\n    state.renderProp(props.item)\n    state.groupRenderProp(props.group)\n    state.itemContainer(props.ItemContainer || 'div')\n    state.groupContainer(props.GroupContainer || 'div')\n    state.scrollSeekConfiguration(props.scrollSeek)\n\n    return () => {\n      state.itemsRendered(undefined)\n      state.totalListHeightChanged(undefined)\n    }\n  }, [\n    state,\n    props.endReached,\n    props.rangeChanged,\n    props.atBottomStateChange,\n    props.scrollingStateChange,\n    props.groupCounts,\n    props.groupIndices,\n    props.itemsRendered,\n    props.totalListHeightChanged,\n    props.item,\n    props.group,\n    props.GroupContainer,\n    props.ItemContainer,\n    props.scrollSeek,\n  ])\n\n  return (\n    <VirtuosoPresentation\n      contextValue={state}\n      style={props.style}\n      className={props.className}\n      footer={props.footer}\n      itemHeight={props.itemHeight}\n      ScrollContainer={props.ScrollContainer}\n      FooterContainer={props.FooterContainer}\n      ListContainer={props.ListContainer}\n    />\n  )\n})\n\nGroupedVirtuoso.displayName = 'GroupedVirtuoso'\n","import { subject, map, combineLatest, withLatestFrom, coldSubject } from './tinyrx'\nimport { makeInput, makeOutput } from './rxio'\nimport { TScrollLocation, buildIsScrolling } from './EngineCommons'\n\ntype GridDimensions = [\n  number, // container width,\n  number, // container height,\n  number | undefined, // item width,\n  number | undefined // item height\n]\n\ntype GridItemRange = [\n  number, // start index\n  number // end index\n]\n\nconst { ceil, floor, min, max } = Math\n\nconst hackFloor = (val: number) => (ceil(val) - val < 0.03 ? ceil(val) : floor(val))\n\nexport const VirtuosoGridEngine = (initialItemCount = 0) => {\n  const gridDimensions$ = subject<GridDimensions>([0, 0, undefined, undefined])\n  const totalCount$ = subject(0)\n  const scrollTop$ = subject(0)\n  const overscan$ = subject(0)\n  const itemRange$ = subject<GridItemRange>([0, max(initialItemCount - 1, 0)])\n  const totalHeight$ = subject(0)\n  const listOffset$ = subject(0)\n  const scrollToIndex$ = coldSubject<TScrollLocation>()\n\n  combineLatest(gridDimensions$, scrollTop$, overscan$, totalCount$)\n    .pipe(withLatestFrom(itemRange$))\n    .subscribe(\n      ([[[viewportWidth, viewportHeight, itemWidth, itemHeight], scrollTop, overscan, totalCount], itemRange]) => {\n        if (itemWidth === undefined || itemHeight === undefined) {\n          return\n        }\n\n        if (totalCount === 0) {\n          itemRange$.next([0, -1])\n          listOffset$.next(0)\n          return\n        }\n\n        const [startIndex, endIndex] = itemRange\n        const itemsPerRow = hackFloor(viewportWidth / itemWidth)\n\n        const toRowIndex = (index: number, roundFunc = floor) => {\n          return roundFunc(index / itemsPerRow)\n        }\n\n        const updateRange = (down: boolean): void => {\n          const [topOverscan, bottomOverscan] = down ? [0, overscan] : [overscan, 0]\n\n          let startIndex = itemsPerRow * floor((scrollTop - topOverscan) / itemHeight)\n\n          let endIndex = itemsPerRow * ceil((scrollTop + viewportHeight + bottomOverscan) / itemHeight) - 1\n\n          endIndex = min(totalCount - 1, endIndex)\n          startIndex = min(endIndex, max(0, startIndex))\n\n          itemRange$.next([startIndex, endIndex])\n          listOffset$.next(toRowIndex(startIndex) * itemHeight)\n        }\n\n        const listTop = itemHeight * toRowIndex(startIndex)\n        const listBottom = itemHeight * toRowIndex(endIndex) + itemHeight\n\n        // totalCount has decreased, we have to re-render\n        if (totalCount < endIndex - 1) {\n          updateRange(true)\n          // user is scrolling up - list top is below the top edge of the viewport\n        } else if (listTop > scrollTop) {\n          updateRange(false)\n          // user is scrolling down - list bottom is above the bottom edge of the viewport\n        } else if (listBottom < scrollTop + viewportHeight) {\n          updateRange(true)\n        }\n\n        totalHeight$.next(itemHeight * toRowIndex(totalCount, ceil))\n      }\n    )\n\n  const scrollTo$ = scrollToIndex$.pipe(\n    withLatestFrom(gridDimensions$, totalCount$),\n    map(([location, [viewportWidth, viewportHeight, itemWidth, itemHeight], totalCount]) => {\n      if (itemWidth === undefined || itemHeight === undefined) {\n        return { top: 0, behavior: 'auto' } as ScrollOptions\n      }\n\n      if (typeof location === 'number') {\n        location = { index: location, align: 'start' }\n      }\n\n      let { index, align = 'start' } = location\n\n      index = Math.max(0, index, Math.min(totalCount - 1, index))\n\n      const itemsPerRow = hackFloor(viewportWidth / itemWidth)\n\n      let offset = floor(index / itemsPerRow) * itemHeight\n\n      if (align === 'end') {\n        offset = offset - viewportHeight + itemHeight\n      } else if (align === 'center') {\n        offset = Math.round(offset - viewportHeight / 2 + itemHeight / 2)\n      }\n\n      return { top: offset, behavior: 'auto' } as ScrollToOptions\n    })\n  )\n\n  const isScrolling$ = buildIsScrolling(scrollTop$)\n\n  const endReached$ = coldSubject<number>()\n  let currentEndIndex = 0\n\n  itemRange$.pipe(withLatestFrom(totalCount$)).subscribe(([[_, endIndex], totalCount]) => {\n    if (totalCount === 0) {\n      return\n    }\n\n    if (endIndex === totalCount - 1) {\n      if (currentEndIndex !== endIndex) {\n        currentEndIndex = endIndex\n        endReached$.next(endIndex)\n      }\n    }\n  })\n\n  return {\n    gridDimensions: makeInput(gridDimensions$),\n    totalCount: makeInput(totalCount$),\n    scrollTop: makeInput(scrollTop$),\n    overscan: makeInput(overscan$),\n    scrollToIndex: makeInput(scrollToIndex$),\n\n    itemRange: makeOutput(itemRange$),\n    totalHeight: makeOutput(totalHeight$),\n    listOffset: makeOutput(listOffset$),\n    scrollTo: makeOutput(scrollTo$),\n    isScrolling: makeOutput(isScrolling$),\n    endReached: makeOutput(endReached$),\n  }\n}\n","import React, { CSSProperties, ReactElement } from 'react'\nimport { VirtuosoGridEngine } from './VirtuosoGridEngine'\nimport { VirtuosoScroller, TScrollContainer } from './VirtuosoScroller'\nimport { useOutput, useSize } from './Utils'\nimport { viewportStyle } from './Style'\nimport { VirtuosoFiller } from './VirtuosoFiller'\nimport { TScrollLocation } from './EngineCommons'\n\ntype TContainer =\n  | React.ComponentType<{ className: string; style?: CSSProperties; key?: number }>\n  | keyof JSX.IntrinsicElements\n\nexport interface VirtuosoGridProps {\n  totalCount: number\n  overscan?: number\n  item: (index: number) => ReactElement\n  style?: CSSProperties\n  className?: string\n  ScrollContainer?: TScrollContainer\n  ListContainer?: TContainer\n  ItemContainer?: TContainer\n  listClassName?: string\n  itemClassName?: string\n  scrollingStateChange?: (isScrolling: boolean) => void\n  endReached?: (index: number) => void\n  initialItemCount?: number\n}\n\ntype VirtuosoGridState = ReturnType<typeof VirtuosoGridEngine>\n\ntype VirtuosoGridFCProps = Omit<VirtuosoGridProps, 'overscan' | 'totalCount'> & { engine: VirtuosoGridState }\n\ntype TItemBuilder = (\n  range: [number, number],\n  item: (index: number) => ReactElement,\n  itemClassName: string,\n  ItemContainer: TContainer\n) => ReactElement[]\n\nexport class VirtuosoGrid extends React.PureComponent<VirtuosoGridProps, VirtuosoGridState> {\n  public state = VirtuosoGridEngine(this.props.initialItemCount)\n\n  public static getDerivedStateFromProps(props: VirtuosoGridProps, engine: VirtuosoGridState) {\n    engine.overscan(props.overscan || 0)\n    engine.totalCount(props.totalCount)\n    engine.isScrolling(props.scrollingStateChange)\n    engine.endReached(props.endReached)\n    return null\n  }\n\n  public scrollToIndex(location: TScrollLocation) {\n    this.state.scrollToIndex(location)\n  }\n\n  public render() {\n    return <VirtuosoGridFC {...this.props} engine={this.state} />\n  }\n}\n\nconst buildItems: TItemBuilder = ([startIndex, endIndex], item, itemClassName, ItemContainer) => {\n  const items = []\n  for (let index = startIndex; index <= endIndex; index++) {\n    items.push(\n      React.createElement(\n        ItemContainer,\n        {\n          key: index,\n          className: itemClassName,\n        },\n        item(index)\n      )\n    )\n  }\n\n  return items\n}\n\nconst VirtuosoGridFC: React.FC<VirtuosoGridFCProps> = ({\n  ScrollContainer,\n  ItemContainer = 'div',\n  ListContainer = 'div',\n  className,\n  item,\n  itemClassName = 'virtuoso-grid-item',\n  listClassName = 'virtuoso-grid-list',\n  engine,\n  style = { height: '40rem' },\n}) => {\n  const { itemRange, listOffset, totalHeight, gridDimensions, scrollTo, scrollTop } = engine\n\n  const fillerHeight = useOutput<number>(totalHeight, 0)\n  const translate = useOutput<number>(listOffset, 0)\n  const listStyle = { marginTop: `${translate}px` }\n  const itemIndexRange = useOutput(itemRange, [0, 0] as [number, number])\n\n  const viewportCallbackRef = useSize(({ element, width, height }) => {\n    const firstItem = element.firstChild!.firstChild as HTMLElement\n    gridDimensions([width, height, firstItem.offsetWidth, firstItem.offsetHeight])\n  })\n\n  return (\n    <VirtuosoScroller\n      style={style}\n      ScrollContainer={ScrollContainer}\n      className={className}\n      scrollTo={scrollTo}\n      scrollTop={scrollTop}\n    >\n      <div ref={viewportCallbackRef} style={viewportStyle}>\n        {React.createElement(\n          ListContainer,\n          {\n            style: listStyle,\n            className: listClassName,\n          },\n          buildItems(itemIndexRange, item, itemClassName, ItemContainer)\n        )}\n      </div>\n\n      <VirtuosoFiller height={fillerHeight} />\n    </VirtuosoScroller>\n  )\n}\n"],"names":["VirtuosoContext","createContext","undefined","combineOperators","operators","length","value","subscriber","acc","slice","reverse","forEach","operator","prevCallback","buildPipe","subscribe","pipe","observable","source","val","subject","initial","distinct","subscribers","next","newVal","push","filter","sub","coldSubject","combineLatest","sources","called","Array","fill","values","publish","every","isCalled","index","map","mapTo","_","done","skip","times","predicate","duc","comparator","current","debounceTime","time","timeout","clearTimeout","setTimeout","throttleTime","scan","scanner","initialValue","prevVal","withLatestFrom","buildIsScrolling","scrollTop$","isScrolling$","adjustForPrependedItemsEngine","offsetList$","scrollTo$","adjustForPrependedItems$","adjustmentInProgress$","count","offsetList","scrollTop","inProgress","empty","adjustForPrependedItems","top","getDefaultSize","followOutputEngine","scrollToIndex$","scrolledToBottom$","totalCount$","followOutput$","followOutput","totalCount","scrolledToBottom","align","behavior","NilNode","rebalance","adjust","shift","remove","find","findWith","findMax","Infinity","findMaxValue","insert","key","NonNilNode","level","walkWithin","walk","ranges","rangesWithin","isSingle","isInvariant","keys","NIL_NODE","Object","freeze","UnreachableCaseError","Error","left","right","amount","clone","last","lastKey","lastValue","deleteLast","callback","result","rightKey","rightValue","start","end","concat","args","skew","split","rl","rightLevel","toRanges","startIndex","endIndex","nodes","first","i","nextNode","AATree","root","defaultValue","adjustedStart","StubIndexTransposer","transpose","items","item","groupIndex","offset","size","transposedIndex","type","GroupIndexTransposer","counts","reduce","groupCount","tree","total","groupMatch","groupIndices","groupCountEngine","transposer$","stickyItems$","groupCounts$","groupIndices$","transposer","getListTop","listEngine","overscan","viewportHeight$","topListHeight$","footerHeight$","minListIndex$","scrolledToTopMostItem$","totalHeight$","listHeight$","endReached$","list$","constrainedScrollTop$","totalHeight","viewportHeight","Math","max","min","topListHeight","listHeight","footerHeight","minIndex","scrolledToTopMostItem","itemLength","listTop","listBottom","maxIndex","indexOutOfAllowedRange","endOffset","range","startOffset","listOffset$","currentEndIndex","maxRangeSizeEngine","scheduledReadjust$","maxRangeSize$","maxRangeSize","list","configureMaxRangeSize","scrollTo","offsetOf","OffsetList","rangeTree","offsetTree","nanIndices","initialTopMostItemIndex","nanFound","rangeSize","isNaN","create","fromTree","rangeSizeExceededCallback","indexOf","groupSize","nanIndex","overlapingRanges","some","firstPassDone","shouldInsert","rangeStart","rangeEnd","rangeValue","insertSpots","spotIndexes","spot","NaN","offsetRange","itemAt","indexRange","rangeOffset","rangeIndex","floor","getOffsets","indices","IndexList","setInitialIndex","topMostItemIndex","maxRangeSizeExceededCallback","initialItemCountEngine","itemHeights$","initialItemCount$","pendingRenderAfterInitial$","unsubscribeInitial","dummyItemHeight","stickyItemsEngine","topList$","stickyItemsIndexList$","stickyItems","params","stickyItemsIndexList","topList","currentStickyItem","offsetListEngine","itemHeight","defaultItemHeight","heightsChanged$","initialOffsetList","heights","pendingRenderAfterInitial","newList","scrolledToBottomEngine","notAtBottom","scrollSeekEngine","range$","rangeChanged$","scrollVelocity$","isSeeking$","scrollSeekConfiguration$","prev","config","speed","isSeeking","exit","enter","velocity","change","initialTopMostItemIndexEngine","scrollToIndexEngine","scrollToIndexRequestPending$","scrollTopReportedAfterScrollToIndex$","changed","location","round","scrollTopReported","scrollToIndexRequestPending","scrollToIndex","topItemCountEngine","topItemCount$","topItemCount","topListEngine","makeOutput","unsubscribe","makeInput","VirtuosoStore","stickyItemsOffset$","MAX_OFFSET_HEIGHT","domTotalHeight$","scrollTopMultiplier$","domTotalHeight","domScrollTop$","domListOffset$","multiplier","domScrollTop","computeItemKey$","itemIndex","renderProp$","_groupIndex","groupRenderProp$","itemContainer$","groupContainer$","itemRender$","dataKey$","Symbol","render","groupRender","scrollSeek","computeItemKey","ItemContainer","GroupContainer","renderPlaceholder","itemProps","React","createElement","children","placeholder","height","groupCounts","itemHeights","initialItemCount","scrollSeekConfiguration","renderProp","groupRenderProp","itemContainer","groupContainer","dataKey","itemRender","scrollVelocity","itemsRendered","listOffset","endReached","atBottomStateChange","totalListHeightChanged","rangeChanged","isScrolling","stickyItemsOffset","viewportStyle","position","width","useHeight","input","onMount","onResize","ref","useRef","animationFrameID","observer","ResizeObserver","entries","newHeight","contentRect","window","requestAnimationFrame","element","target","document","body","contains","callbackRef","elRef","observe","unobserve","useEffect","cancelAnimationFrame","callbackToValue","output","useOutput","useState","setValue","useSize","currentSize","simpleMemoize","func","WEBKIT_STICKY","STICKY","positionStickyCssValue","node","style","VirtuosoFiller","VirtuosoList","memo","useContext","topItems","renderedItems","topOffset","renderedTopItemIndices","marginTop","zIndex","props","scrollerStyle","overflowY","WebkitOverflowScrolling","outline","DefaultScrollContainer","className","reportScrollTop","smoothScrollTarget","currentScrollTop","onScroll","useCallback","e","theRef","addEventListener","passive","removeEventListener","tabIndex","VirtuosoScroller","ScrollContainer","DefaultFooterContainer","footerRef","DefaultListContainer","listRef","VirtuosoFooter","footer","FooterContainer","footerCallbackRef","getHeights","results","len","child","dataset","parseInt","knownSize","offsetHeight","lastResult","ListWrapper","fixedItemHeight","ListContainer","translate","listCallbackRef","measuredItemHeights","VirtuosoView","fillerHeight","st","viewportCallbackRef","DEFAULT_STYLE","VirtuosoPresentation","contextValue","Provider","Virtuoso","forwardRef","state","useImperativeHandle","scrollingStateChange","maxHeightCacheSize","displayName","GroupedVirtuoso","group","ceil","hackFloor","VirtuosoGridEngine","gridDimensions$","overscan$","itemRange$","viewportWidth","itemWidth","itemRange","itemsPerRow","toRowIndex","roundFunc","updateRange","down","topOverscan","bottomOverscan","gridDimensions","VirtuosoGrid","getDerivedStateFromProps","engine","VirtuosoGridFC","PureComponent","buildItems","itemClassName","listClassName","listStyle","itemIndexRange","firstItem","firstChild","offsetWidth"],"mappings":"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"}